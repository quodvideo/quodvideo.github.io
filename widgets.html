<!DOCTYPE html>
<html lang="en">
  <head>
    <title>widgets</title>
    <style>
      :root {
        --outline-color: black;
        --input-field-color: white;
        --highlight-stroke-color: white;
        --shadow-stroke-color: grey;
        --raised-fill-color: #efefef;
        --recessed-fill-color: #bbbbbb;
        --base-fill-color: #dddddd;
        --grip-fill-color: #eeeeee;
        --grip-stroke-color: #aaaaaa;
        /* Consider adding colors for when a button is actively being pushed and not just in the ON state. */
        font-family: sans-serif;
      }
      :focus {
        outline: none;
      }
      .highlight {
        fill: none;
        stroke: var(--highlight-stroke-color);
      }
      .shadow {
        fill: none;
        stroke: var(--shadow-stroke-color);
      }
      text {
        font-family: Sans-serif;
        font-size: 12px; /* 13.3px; */
        stroke: none;
        fill: black;
      }
      text.centered {
        text-anchor: middle;
        dominant-baseline: central;
      }
      .button {
        cursor: default;
        & rect:first-child {
          fill: var(--raised-fill-color);
          stroke: var(--outline-color);
          + polyline {
            fill: none;
            stroke: var(--shadow-stroke-color);
            + polyline {
              fill: none;
              stroke: var(--highlight-stroke-color);
            }
          }
        }
        &:active {
          & rect:first-child {
            fill: var(--recessed-fill-color);
            stroke: var(--outline-color);
            + polyline {
              stroke: var(--highlight-stroke-color);              
              + polyline {
                stroke: var(--shadow-stroke-color);
              }
            }
          }
        }
      }
      rect.trough {
        fill: var(--recessed-fill-color);
        stroke: var(--outline-color);
        + polyline {
          fill: none;
          stroke: var(--shadow-stroke-color);
          + polyline {
            fill: none;
            stroke: var(--highlight-stroke-color);
          }
        }
      }
      .slider {
        & rect {
          fill: var(--raised-fill-color);
          stroke: var(--outline-color);
          + polyline {
            fill: none;
            stroke: var(--shadow-stroke-color);
            + polyline {
              fill: none;
              stroke: var(--highlight-stroke-color);
            }
          }
        }
      }
      .textfield {
        cursor: text;
        & rect:first-child {
          fill: var(--input-field-color);
          stroke: var(--outline-color);
          + polyline {
            fill: none;
            stroke: var(--shadow-stroke-color);
            + polyline {
              fill: none;
              stroke: var(--highlight-stroke-color);
            }
          }
        }
      }
      rect.focusring {
        fill: none;
        stroke: none;
      }
      :focus rect.focusring {
        fill: none;
        stroke: var(--outline-color);
      }
    </style>
  </head>
  <body>
    <p>These are just drawings for prototyping, not actual widgets. After the drawings, there is some description of the system I want to make.</p>
    <p>The style of these drawings is meant as a guide. It might be possible to do this without SVG, but I remember some details being hard or impossible to achieve with Gtk 2.x. The way scroll bars join with a text field was one impossibility. Part of the idea is to make it obvious when widgets are not active because they're in a background window or because they just can't be used in the current state. This should all work for various modes like light, dark, high contrast, and low contrast. It should be possible to change the basic colors per widget and with themes. I suspect this basic style can also be adapted to use gradients, blends, patterns, and more.</p>
    <p>This style is heavy compared to most of today's GUIs. That's on purpose. If a window looks too "chrome-y" with this style, then there's probably a better design.</p>
    <svg width="1" height="1"><title>Definitions</title>
      <defs>
        <pattern id="pattern0" width="2" height="2" x="0" y="0" patternUnits="userSpaceOnUse" patternTransform="rotate(-45)">
          <rect height="1" width="2" fill="var(--shadow-stroke-color)" stroke="none" />
          <rect y="1" height="1" width="2" fill="var(--highlight-stroke-color)" stroke="none" />
        </pattern>
        <pattern id="patternv" width="2" height="2" x="0" y="0" patternUnits="userSpaceOnUse">
          <rect height="1" width="2" fill="var(--highlight-stroke-color)" stroke="none" />
          <rect y="1" height="1" width="2" fill="var(--shadow-stroke-color)" stroke="none" />
        </pattern>
        <pattern id="patternh" width="2" height="2" x="0" y="0" patternUnits="userSpaceOnUse">
          <rect height="2" width="1" fill="var(--highlight-stroke-color)" stroke="none" />
          <rect x="1" height="2" width="1" fill="var(--shadow-stroke-color)" stroke="none" />
        </pattern>
        <clipPath id="cornerclip">
          <path d="M1,16 L16 1 V16 Z" />
        </clipPath>
        <symbol id="newcornergrip">
          <rect width="100" height="100" fill="url(#pattern0)" clip-path="url(#cornerclip)" />
        </symbol>
        <symbol id="newArrowDown" viewBox="-4 -6.5 16 16">
          <path d="M0,0 H8 L4,4Z" stroke="none" fill="var(--outline-color)"/>
        </symbol>
        <symbol id="newArrowUp" viewBox="-4 -5.5 16 16">
          <path d="M0,4 H8 L4,0Z" stroke="none" fill="var(--outline-color)"/>
        </symbol>
        <symbol id="newArrowRight" viewBox="-6.5 -4 16 16">
          <path d="M0,0 V8 L4,4Z" stroke="none" fill="var(--outline-color)"/>
        </symbol>
        <symbol id="newArrowLeft" viewBox="-5.5 -4 16 16">
          <path d="M4,0 V8 L0,4Z" stroke="none" fill="var(--outline-color)"/>
        </symbol>
        <symbol id="minusSign" viewbox="0 0 20 20">
          <line x1="4.5" y1="10.5" x2="16.5" y2="10.5" stroke-width="2" stroke="black"/>
        </symbol>
        <symbol id="plusSign" viewbox="0 0 20 20">
          <line x1="4.5" y1="10.5" x2="16.5" y2="10.5" stroke-width="2" stroke="black"/>
          <line x1="10.5" y1="4.5" x2="10.5" y2="16.5" stroke-width="2" stroke="black"/>
        </symbol>
        <symbol id="documentIcon" viewBox="0 0 16 16">
          <path stroke="var(--outline-color)" fill="inherit" vector-effect="non-scaling-stroke"
                d="M14.5,5.5 H9.5 V0.5 L14.5,5.5 V15.5 H1.5 V0.5 H9.5"/>
        </symbol>
        <symbol id="folderIcon" viewbox="0 0 16 16">
          <path stroke="var(--outline-color)" fill="inherit" vector-effect="non-scaling-stroke"
                d="M8.5,3.5 L6.5,5.5 H0.5 V3.5 L2.5,1.5 H6.5 L8.5,3.5 H15.5 V14.5 H0.5 V5.5"/>
        </symbol>
        <g id="hGrippy">
          <rect width="10" height="10" fill="url(#patternh)"/>
        </g>
        <g id="vGrippy">
          <rect width="10" height="10" fill="url(#patternv)"/>
        </g>
        <clipPath id="circle-slice">
          <polyline points="-2,14 14,-2 -2,-2 -2,14"/>
        </clipPath>
        <g id="radioCircle">
          <circle cx="6" cy="6" r="7" fill="white" stroke="white"/>
          <circle cx="6" cy="6" r="7" fill="darkgrey" stroke="darkgrey" clip-path="url(#circle-slice)"/>
          <circle cx="6" cy="6" r="6" fill="#ffffff" stroke="var(--outline-color)"/>
        </g>
        <symbol id="checkmark">
          <path d="M1,6.5 L5,10.5 L11,1.5" stroke="#000" stroke-width="2" fill="none"/>
        </symbol>
        <g id="checkbox">
          <rect width="12" height="12" fill="white" stroke="var(--outline-color)"/>
          <polyline class="shadow" points="-1,13 -1,-1 13,-1"/>
          <polyline class="highlight" points="-1,13 13,13 13,-1"/>
        </g>
        <g id="sheettab-active">
          <path fill="none" stroke="white" d="M0.5,0.5 h70"/>
          <path fill="white" stroke="var(--outline-color)" d="M0.5,0.5 h5 l5,13 h50 l5,-13 h5"/>
          <path fill="none" stroke="none" d="M0.5,0.5 h70"/>
          <text style="font-size: 10;font-family:Sans-serif;text-anchor:middle;" x="35.5" y="10.5">label</text>
        </g>
        <g id="sheettab-inactive">
          <path fill="none" stroke="none" d="M0.5,0.5 h70"/>
          <path fill="white" stroke="var(--outline-color)" d="M0.5,0.5 h5 l5,13 h50 l5,-13 h5"/>
          <path fill="none" stroke="var(--outline-color)" d="M0.5,0.5 h70"/>
          <text style="font-size: 10;font-family:Sans-serif;text-anchor:middle;" x="35.5" y="10.5">label</text>
        </g>
        <g id="sheetTabGroup">
          <!-- old note: Alternative: Let the tabs go to 15 and don't outline the area. -->
          <rect width="180" height="16" fill="var(--base-fill-color)" stroke="var(--outline-color)"/>
          <path fill="#ffffff" stroke="var(--outline-color)" d="M0,0 H115 L120,13 H170 L175,0 H180"/>
          <text style="font-size: 10; font-family: Sans-serif; stroke: none; fill: black;" x="141" y="10">3</text>
          <path fill="#ffffff" stroke="var(--outline-color)" d="M0,0 H60 L65,13 H115 L120,0 H180"/>
          <text style="font-size: 10; font-family: Sans-serif; stroke: none; fill: black;" x="86" y="10">2</text>
          <path d="M1,0 H179" stroke="#ffffff"/>
          <path fill="#ffffff" stroke="var(--outline-color)" d="M0,0 H5 L10,13 H60 L65,0 H180"/>
          <text style="font-size: 10; font-family: Sans-serif; stroke: none; fill: black;" x="31" y="10">1</text>
        </g>
      </defs>
    </svg>
    <svg id="testfield" width="800" height="600">
      <rect width="800" height="600" fill="var(--base-fill-color)" stroke="none"/>
    </svg>
    <!--
        <g class=widget>
          <rect class=base>
          <polyline class=shadow>
          <polyline class=highlight>
          <text>
          <rect class=focusring>
          <rect class=defaultmarker>
        </g>
    -->
    <script>
      tf = document.getElementById("testfield");
      function drawRaisedRect (parentElement,x,y,width,height) {
        var r = document.createElementNS("http://www.w3.org/2000/svg","rect");
        r.setAttribute("x", x+0.5);
        r.setAttribute("y", y+0.5);
        r.setAttribute("width", width-1);
        r.setAttribute("height", height-1);
        parentElement.insertAdjacentElement("beforeend", r);

        var s = document.createElementNS("http://www.w3.org/2000/svg","polyline");
        s.setAttribute("points",""+(x+1.5)+","+(y+height-1.5)+" "+(x+width-1.5)+","+(y+height-1.5)+" "+(x+width-1.5)+","+(y+1.5));
        parentElement.insertAdjacentElement("beforeend", s);

        var h = document.createElementNS("http://www.w3.org/2000/svg","polyline");
        h.setAttribute("points",""+(x+1.5)+","+(y+height-1.5)+" "+(x+1.5)+","+(y+1.5)+" "+(x+width-1.5)+","+(y+1.5));
        parentElement.insertAdjacentElement("beforeend", h);

        return r;
      }
      function drawTroughRect (parentElement,x,y,width,height) {
        var trough = document.createElementNS("http://www.w3.org/2000/svg","rect");
        trough.setAttribute("x", x+0.5);
        trough.setAttribute("y", y+0.5);
        trough.setAttribute("width", width-1);
        trough.setAttribute("height", height-1);
        trough.setAttribute("class","trough");
        parentElement.insertAdjacentElement("beforeend", trough);

        var shadow = document.createElementNS("http://www.w3.org/2000/svg","polyline");
        shadow.setAttribute("points",""+(x+1.5)+","+(y+height-1.5)+" "+(x+1.5)+","+(y+1.5)+" "+(x+width-1.5)+","+(y+1.5))
        parentElement.insertAdjacentElement("beforeend", shadow);
        
        var highlight = document.createElementNS("http://www.w3.org/2000/svg","polyline");
        highlight.setAttribute("points",""+(x+1.5)+","+(y+height-1.5)+" "+(x+width-1.5)+","+(y+height-1.5)+" "+(x+width-1.5)+","+(y+1.5))
        parentElement.insertAdjacentElement("beforeend", highlight);
        
        return trough;
      }
      function drawFocusRingRect (parentElement,x,y,width,height) {
        var r = document.createElementNS("http://www.w3.org/2000/svg","rect");
        r.setAttribute("x",x+0.5);
        r.setAttribute("y",y+0.5);
        r.setAttribute("width",width-1);
        r.setAttribute("height",height-1);
        r.setAttribute("class","focusring");
        parentElement.insertAdjacentElement("beforeend",r);
        return r;
      }
      function drawBaseWindow (parentElement,x,y,width,height) {
        var g = document.createElementNS("http://www.w3.org/2000/svg","g");
        g.setAttribute("transform","translate("+x+","+y+")")
        parentElement.insertAdjacentElement("beforeend",g);
        var r = document.createElementNS("http://www.w3.org/2000/svg","rect");
        r.setAttribute("x", 0.5);
        r.setAttribute("y", 0.5);
        r.setAttribute("width", width-1);
        r.setAttribute("height", height-1);
        r.setAttribute("fill","var(--base-fill-color)");
        r.setAttribute("stroke","var(--outline-color)");
        g.insertAdjacentElement("beforeend",r);
        var s = document.createElementNS("http://www.w3.org/2000/svg","polyline");
        s.setAttribute("class","shadow");
        s.setAttribute("points","1.5,"+(height-1.5)+" "+(width-1.5)+","+(height-1.5)+" "+(width-1.5)+",1.5");
        g.insertAdjacentElement("beforeend",s);
        var h = document.createElementNS("http://www.w3.org/2000/svg","polyline");
        h.setAttribute("class","highlight");
        h.setAttribute("points","1.5,"+(height-1.5)+" 1.5,1.5 "+(width-1.5)+",1.5");
        g.insertAdjacentElement("beforeend",h);
        var u = document.createElementNS("http://www.w3.org/2000/svg","use");
        u.setAttribute("x",width-18);
        u.setAttribute("y",height-18);
        u.setAttributeNS("http://www.w3.org/1999/xlink","href","#newcornergrip");
        g.insertAdjacentElement("beforeend",u);
        return g;
      }
      function drawButton (parentElement,x,y,width,height,isDefault,isFocusable) {
        var g = document.createElementNS("http://www.w3.org/2000/svg","g");
        g.setAttribute("class","button");
        g.setAttribute("transform","translate("+x+","+y+")");
        if (isFocusable) g.setAttribute("tabindex",0);
        parentElement.insertAdjacentElement("beforeend", g);

        drawRaisedRect(g,0,0,width,height);
        drawFocusRingRect(g,-2,-2,width+4,height+4);

        if (isDefault) {
          var r = document.createElementNS("http://www.w3.org/2000/svg","rect");
          r.setAttribute("x", -0.5);
          r.setAttribute("y", -0.5);
          r.setAttribute("width", width+1);
          r.setAttribute("height", height+1);
          r.setAttribute("style","fill: none; stroke: var(--outline-color);");
          g.insertAdjacentElement("beforeend", r);          
        }

        return g;
      }
      function drawToggleButton (parentElement,x,y,width,height,isFocusable,state) {
        var g = drawButton(parentElement,x,y,width,height,false,isFocusable);
        g.setAttribute("class","togglebutton");
        return g;
      }
      function drawPushButton (parentElement,x,y,width,height,text,isDefault) {
        var txt = document.createElementNS("http://www.w3.org/2000/svg","text");
        txt.innerHTML = text;
        txt.setAttribute("class","centered");
        txt.setAttribute("pointer-events","none");
        var box = txt.getBBox();
        if (width<64) width=64;
        if (height<22) height=22;
        if (box.width > width+12) width=box.width+12;
        if (box.height > height+5) height=box.height+5;
        txt.setAttribute("x",width/2);
        txt.setAttribute("y",height/2);
        var btn = drawButton (parentElement,x,y,width,height,isDefault,true);
        btn.insertAdjacentElement("beforeend",txt);
        return btn;
      }
      function drawStepper (parentElement,x,y,width,height,dir) {
        var stepper = drawButton(parentElement,x,y,width,height,false,false);
        var stepperArrow = document.createElementNS("http://www.w3.org/2000/svg","use");
        stepperArrow.setAttribute("width",width);
        stepperArrow.setAttribute("height",height);
        var arrow="#none";
        switch (dir) {
          case "up": arrow="#newArrowUp"; break;
          case "down": arrow="#newArrowDown"; break;
          case "left": arrow="#newArrowLeft"; break;
          case "right": arrow="#newArrowRight"; break;
        }
        stepperArrow.setAttributeNS("http://www.w3.org/1999/xlink","href",arrow);
        stepper.insertAdjacentElement("beforeend", stepperArrow);
        return stepper;
      }
      function drawSlider (parentElement,x,y,width,height,dir) {
        var g = document.createElementNS("http://www.w3.org/2000/svg","g");
        g.setAttribute("class","slider");
        g.setAttribute("transform","translate("+x+","+y+")");
        parentElement.insertAdjacentElement("beforeend", g);

        drawRaisedRect(g,0,0,width,height);

        var grip = document.createElementNS("http://www.w3.org/2000/svg","use");
        switch (dir) {
          case "horizontal":
            grip.setAttribute("x",width/2-5);
            grip.setAttribute("y",3);
            grip.setAttributeNS("http://www.w3.org/1999/xlink","href","#hGrippy");
            break;
          case "vertical":
            grip.setAttribute("x",3);
            grip.setAttribute("y",height/2-5);
            grip.setAttributeNS("http://www.w3.org/1999/xlink","href","#vGrippy");
            break;
        }
        g.insertAdjacentElement("beforeend", grip);

        return g;
      }
      function drawHScrollBar (parentElement,x,y,width,height) {
        var g = document.createElementNS("http://www.w3.org/2000/svg","g");
        g.setAttribute("transform","translate("+x+","+y+")");
        parentElement.insertAdjacentElement("beforeend", g);
        drawTroughRect(g,0,0,width-height-height+3,height);
        drawStepper(g,width-height-height+2,0,height,height,"left");
        drawStepper(g,width-height+1,0,height,height,"right");
        drawSlider(g,10,0,32,height,"horizontal");
        return g;
      }
      function drawVScrollBar (parentElement,x,y,width,height) {
        var g = document.createElementNS("http://www.w3.org/2000/svg","g");
        g.setAttribute("transform","translate("+x+","+y+")");
        parentElement.insertAdjacentElement("beforeend", g);
        drawTroughRect(g,0,0,width,height-width-width+3);
        drawStepper(g,0,height-width-width+2,width,width,"up");
        drawStepper(g,0,height-width+1,width,width,"down");
        drawSlider(g,0,10,width,32,"vertical");
        return g;
      }
      function drawInputField (parentElement,x,y,width,height) {
        var g = document.createElementNS("http://www.w3.org/2000/svg","g");
        g.setAttribute("class","textfield");
        g.setAttribute("transform","translate("+x+","+y+")");
        g.setAttribute("tabindex",0);
        parentElement.insertAdjacentElement("beforeend",g);

        var field = document.createElementNS("http://www.w3.org/2000/svg","rect");
        field.setAttribute("x",1.5);
        field.setAttribute("y",1.5);
        field.setAttribute("width",width-3);
        field.setAttribute("height",height-3);
        g.insertAdjacentElement("beforeend",field);

        var shadow = document.createElementNS("http://www.w3.org/2000/svg","polyline");
        shadow.setAttribute("points","0.5,"+(height-1)+" 0.5,0.5 "+(width-1)+",0.5");
        g.insertAdjacentElement("beforeend",shadow);

        var highlight = document.createElementNS("http://www.w3.org/2000/svg","polyline");
        highlight.setAttribute("points","0,"+(height-0.5)+" "+(width-0.5)+","+(height-0.5)+" "+(width-0.5)+",0");
        g.insertAdjacentElement("beforeend",highlight);

        drawFocusRingRect(g,0,0,width,height);
        
        var t = document.createElementNS("http://www.w3.org/2000/svg","text");
        g.insertAdjacentElement("beforeend",t);

        return g;
      }
      function drawCutawayField (parentElement,x,y,width,height,showVScrollbar,showHScrollbar) {
        var g = document.createElementNS("http://www.w3.org/2000/svg","g");
        g.setAttribute("transform","translate("+x+","+y+")");
        parentElement.insertAdjacentElement("beforeend",g);

        var p = document.createElementNS("http://www.w3.org/2000/svg","path");
        p.setAttribute("fill","var(--input-field-color)");
        p.setAttribute("stroke","var(--outline-color)");
        p.setAttribute("d","M1.5,1.5 V "+(height-1.5)+" H "+(width-16.5)+" V "+(height-16.5)+" H "+(width-1.5)+" V 1.5 Z");
        g.insertAdjacentElement("beforeend",p);

        var s = document.createElementNS("http://www.w3.org/2000/svg","polyline");
        s.setAttribute("class","shadow");
        s.setAttribute("points","0.5,"+(height-0.5)+" 0.5,0.5 "+(width-0.5)+",0.5");
        g.insertAdjacentElement("beforeend",s);

        var h = document.createElementNS("http://www.w3.org/2000/svg","polyline");
        h.setAttribute("class","highlight");
        h.setAttribute("points","0.5,"+(height-0.5)+" "+(width-15.5)+","+(height-0.5)+" "+(width-15.5)+","+(height-15.5)+" "+(width-0.5)+","+(height-15.5)+" "+(width-0.5)+",0.5");
        g.insertAdjacentElement("beforeend",h);

        if (showVScrollbar) {
          drawVScrollBar(g,width-17,1,16,height-18);
        }
        if (showHScrollbar) {
          drawHScrollBar(g,1,height-17,width-18,16);
        }
      }
      function drawSpinButton (parentElement,x,y,width,height) {
        var g = document.createElementNS("http://www.w3.org/2000/svg","g");
        g.setAttribute("transform","translate("+x+","+y+")");
        parentElement.insertAdjacentElement("beforeend",g);

        var field = drawInputField(g,0,0,width,height);

        var btndn = drawButton(g,1,1,height-2,height-2,false,false);
        var minus = document.createElementNS("http://www.w3.org/2000/svg","use");
        minus.setAttribute("width",height-2);
        minus.setAttribute("height",height-2);
        minus.setAttributeNS("http://www.w3.org/1999/xlink","href","#minusSign");
        btndn.insertAdjacentElement("beforeend",minus);

        var btnup = drawButton(g,width-height+1,1,height-2,height-2,false,false);
        var plus = document.createElementNS("http://www.w3.org/2000/svg","use");
        plus.setAttribute("width",height-2);
        plus.setAttribute("height",height-2);
        plus.setAttributeNS("http://www.w3.org/1999/xlink","href","#plusSign");
        btnup.insertAdjacentElement("beforeend",plus);
      }
      function drawSwitch (parentElement,x,y,width,height,state) {
        var sliderX = 0;
        var textX = 3*width/4;
        var word = "OFF";
        switch (state) {
          case "off":
            sliderX = 0;
            textX = 3*width/4;
            word = "OFF";
            break;
          case "on":
            sliderX = width/2;
            textX = width/4;
            word = "ON";
            break;
        }
        var g = document.createElementNS("http://www.w3.org/2000/svg","g");
        g.setAttribute("transform","translate("+x+","+y+")");
        g.setAttribute("tabindex",0);
        parentElement.insertAdjacentElement("beforeend",g);
        var trough = drawTroughRect(g,0,0,width,height);
        var slider = drawSlider(g,sliderX,0,width/2,height);
        var txt = document.createElementNS("http://www.w3.org/2000/svg","text");
        txt.innerHTML = word;
        txt.setAttribute("class","centered");
        txt.setAttribute("x",textX);
        txt.setAttribute("y",height/2);
        g.insertAdjacentElement("beforeend",txt);

        drawFocusRingRect(g,-2,-2,width+4,height+4);

        return g;
      }
      function drawCheckButton (parentElement,x,y,width,height,text,state) {
        var g = document.createElementNS("http://www.w3.org/2000/svg","g");
        g.setAttribute("transform","translate("+x+","+y+")");
        g.setAttribute("tabindex",0);
        parentElement.insertAdjacentElement("beforeend",g);

        var cb = document.createElementNS("http://www.w3.org/2000/svg","use");
        cb.setAttribute("x",0.5);
        cb.setAttribute("y",0.5);
        cb.setAttributeNS("http://www.w3.org/1999/xlink","href","#checkbox");
        g.insertAdjacentElement("beforeend",cb);

        var txt = document.createElementNS("http://www.w3.org/2000/svg","text");
        txt.innerHTML = text;
        txt.setAttribute("x",16.5);
        txt.setAttribute("y",10.5);
        g.insertAdjacentElement("beforeend",txt);

        switch (state) {
          case "mixed":
            var m = document.createElementNS("http://www.w3.org/2000/svg","line");
            m.setAttribute("x1",2);
            m.setAttribute("y1",6.5);
            m.setAttribute("x2",11);
            m.setAttribute("y2",6.5);
            m.setAttribute("stroke-width",2);
            m.setAttribute("stroke","var(--outline-color)");
            g.insertAdjacentElement("beforeend",m);
            break;
          case "on":
            var m = document.createElementNS("http://www.w3.org/2000/svg","use");
            m.setAttributeNS("http://www.w3.org/1999/xlink","href","#checkmark");
            g.insertAdjacentElement("beforeend",m);
            break;
        }

        drawFocusRingRect(g,-3,-3,txt.getBBox().width + 25,19);

        return g;
      }
      function drawRadioButton (parentElement,x,y,width,height,text,state) {
        var g = document.createElementNS("http://www.w3.org/2000/svg","g");
        g.setAttribute("transform","translate("+x+","+y+")");
        g.setAttribute("tabindex",0);
        parentElement.insertAdjacentElement("beforeend",g);

        var cb = document.createElementNS("http://www.w3.org/2000/svg","use");
        cb.setAttribute("x",0.5);
        cb.setAttribute("y",0.5);
        cb.setAttributeNS("http://www.w3.org/1999/xlink","href","#radioCircle");
        g.insertAdjacentElement("beforeend",cb);

        var txt = document.createElementNS("http://www.w3.org/2000/svg","text");
        txt.innerHTML = text;
        txt.setAttribute("x",16.5);
        txt.setAttribute("y",10.5);
        g.insertAdjacentElement("beforeend",txt);

        switch (state) {
          case "mixed":
            var m = document.createElementNS("http://www.w3.org/2000/svg","line");
            m.setAttribute("x1",2);
            m.setAttribute("y1",6.5);
            m.setAttribute("x2",11);
            m.setAttribute("y2",6.5);
            m.setAttribute("stroke-width",2);
            m.setAttribute("stroke","var(--outline-color)");
            g.insertAdjacentElement("beforeend",m);
            break;
          case "on":
            var m = document.createElementNS("http://www.w3.org/2000/svg","circle");
            m.setAttribute("cx",6.5);
            m.setAttribute("cy",6.5);
            m.setAttribute("r",2);
            m.setAttribute("fill","var(--outline-color)");
            m.setAttribute("stroke","var(--outline-color)");
            g.insertAdjacentElement("beforeend",m);
            break;
        }
        
        drawFocusRingRect(g,-3,-3,txt.getBBox().width + 25,19);
        
        return g;
      }
      function drawRevealButton (parentElement,x,y,width,height,text,state) {
        var g = document.createElementNS("http://www.w3.org/2000/svg","g");
        g.setAttribute("transform","translate("+x+","+y+")");
        g.setAttribute("tabindex",0);
        parentElement.insertAdjacentElement("beforeend",g);

        var g2 = document.createElementNS("http://www.w3.org/2000/svg","g");
        var p1 = document.createElementNS("http://www.w3.org/2000/svg","path");
        p1.setAttribute("fill","var(--raised-fill-color)");
        p1.setAttribute("stroke","var(--outline-color)");
        p1.setAttribute("d","M3,0 V12 H4 L10,6 L4,0 Z");
        g2.insertAdjacentElement("beforeend",p1);

        var p2 = document.createElementNS("http://www.w3.org/2000/svg","path");
        p2.setAttribute("class","shadow");
        var p3 = document.createElementNS("http://www.w3.org/2000/svg","path");
        p3.setAttribute("class","highlight");

        switch (state) {
          case "closed":
            g2.setAttribute("transform","translate(0.5,0.5)");
            p2.setAttribute("d","M4,11 L9,6");
            p3.setAttribute("d","M4,11 V1 L9,6");
            break;
          case "turning":
            g2.setAttribute("transform","rotate(45 6 6) translate(0.5,0.5)");
            p2.setAttribute("d","M4,11 L9,6 L4,1");
            p3.setAttribute("d","M4,11 V1");
            break;
          case "open":
            g2.setAttribute("transform","rotate(90 6 6) translate(0.5,0.5)");
            p2.setAttribute("d","M9,6 L4,1");
            p3.setAttribute("d","M 9,6 L4,11 V1");
            break;
        }

        g2.insertAdjacentElement("beforeend",p2);
        g2.insertAdjacentElement("beforeend",p3);

        var p4 = document.createElementNS("http://www.w3.org/2000/svg","path");
        p4.setAttribute("fill","none");
        p4.setAttribute("stroke","var(--outline-color)");
        p4.setAttribute("d","M3,0 V12 H4 L10,6 L4,0 Z");
        g2.insertAdjacentElement("beforeend",p4);

        g.insertAdjacentElement("beforeend",g2);

        var txt = document.createElementNS("http://www.w3.org/2000/svg","text");
        txt.innerHTML = text;
        txt.setAttribute("x",16.5);
        txt.setAttribute("y",10.5);
        g.insertAdjacentElement("beforeend",txt);

        drawFocusRingRect(g,-3,-3,txt.getBBox().width + 25,19);

        return g;
      }
      function drawOptionButton (parentElement,x,y,width,height,text) {
        var txt = document.createElementNS("http://www.w3.org/2000/svg","text");
        txt.innerHTML = text;
        txt.setAttribute("class","centered");
        var box = txt.getBBox();
        if (width<64) width=64;
        if (height<22) height=22;
        if (box.width > width+12) width=box.width+12;
        if (box.height > height+5) height=box.height+5;

        var g = document.createElementNS("http://www.w3.org/2000/svg","g");
        g.setAttribute("transform","translate("+x+","+y+")");
        g.setAttribute("tabindex",0);
        parentElement.insertAdjacentElement("beforeend", g);

        var r = document.createElementNS("http://www.w3.org/2000/svg", "rect");
        r.setAttribute("x", 0.5);
        r.setAttribute("y", 0.5);
        r.setAttribute("width", width+height-1);
        r.setAttribute("height", height-1);
        r.setAttribute("fill","var(--raised-fill-color)");
        r.setAttribute("stroke","var(--outline-color)");
        g.insertAdjacentElement("beforeend", r);

        var s1 = document.createElementNS("http://www.w3.org/2000/svg","polyline");
        s1.setAttribute("class","shadow");
        s1.setAttribute("points","1.5,"+(height-1.5)+" "+(width-0.5)+","+(height-1.5)+" "+(width-0.5)+",1.5");
        g.insertAdjacentElement("beforeend",s1);

        var h1 = document.createElementNS("http://www.w3.org/2000/svg","polyline");
        h1.setAttribute("class","highlight");
        h1.setAttribute("points","1.5,"+(height-1.5)+" 1.5,1.5 "+(width-0.5)+",1.5");
        g.insertAdjacentElement("beforeend",h1);

        var s2 = document.createElementNS("http://www.w3.org/2000/svg","polyline");
        s2.setAttribute("class","shadow");
        s2.setAttribute("points",(width+0.5)+","+(height-1.5)+" "+(width+height-1.5)+","+(height-1.5)+" "+(width+height-1.5)+",1.5");
        g.insertAdjacentElement("beforeend",s2);

        var h2 = document.createElementNS("http://www.w3.org/2000/svg","polyline");
        h2.setAttribute("class","highlight");
        h2.setAttribute("points",(width+0.5)+","+(height-1.5)+" "+(width+0.5)+",1.5 "+(width+height-1.5)+",1.5");
        g.insertAdjacentElement("beforeend",h2);

        var a = document.createElementNS("http://www.w3.org/2000/svg","use");
        a.setAttribute("x",width+0.5);
        a.setAttribute("width",height-1);
        a.setAttribute("height",height-1);
        a.setAttributeNS("http://www.w3.org/1999/xlink","href","#newArrowDown");
        g.insertAdjacentElement("beforeend",a);

        txt.setAttribute("x",width/2);
        txt.setAttribute("y",height/2);
        g.insertAdjacentElement("beforeend",txt);

        drawFocusRingRect(g,-2,-2,width+height+4,height+4);

        return g;
      }
      function drawHLevel (parentElement,x,y,width,height) {
        var g = document.createElementNS("http://www.w3.org/2000/svg","g");
        g.setAttribute("transform","translate("+x+","+y+")");
        g.setAttribute("tabindex",0);
        parentElement.insertAdjacentElement("beforeend", g);

        drawTroughRect(g,0,height/2-2,width,4);
        drawSlider(g,10,0,height,height,"horizontal");
        drawFocusRingRect(g,-2,-2,width+4,height+4);

        return g;
      }
      function drawVLevel (parentElement,x,y,width,height) {
        var g = document.createElementNS("http://www.w3.org/2000/svg","g");
        g.setAttribute("transform","translate("+x+","+y+")");
        g.setAttribute("tabindex",0);
        parentElement.insertAdjacentElement("beforeend", g);

        drawTroughRect(g,width/2-2,0,4,height);
        drawSlider(g,0,10,width,width,"vertical");
        drawFocusRingRect(g,-2,-2,width+4,height+4);

        return g;
      }
      function drawHeaderBar (parentElement,x,y,width,height,icon,title,subtitle) {
          var g = document.createElementNS("http://www.w3.org/2000/svg","g");
          g.setAttribute("transform","translate("+x+","+y+")");
          parentElement.insertAdjacentElement("beforeend",g);

          var i = document.createElementNS("http://www.w3.org/2000/svg","use");
          i.setAttribute("x",5);
          i.setAttribute("y",6);
          i.setAttribute("width",40);
          i.setAttribute("height",40);
          i.setAttribute("fill","white");
          i.setAttributeNS("http://www.w3.org/1999/xlink","href",icon);
          g.insertAdjacentElement("beforeend",i);

          var t = document.createElementNS("http://www.w3.org/2000/svg","text");
          t.setAttribute("x",56);
          t.setAttribute("y",24);
          t.setAttribute("style","font-size: 24;");
          t.innerHTML = title;
          g.insertAdjacentElement("beforeend",t);

          var s = document.createElementNS("http://www.w3.org/2000/svg","text");
          s.setAttribute("x",56);
          s.setAttribute("y",41);
          s.setAttribute("style","font-style: italic; font-size:13.3");
          s.innerHTML = subtitle;
          g.insertAdjacentElement("beforeend",s);

          return g;
        }
      drawHScrollBar(tf,10,10,100,16);
      drawVScrollBar(tf,120,10,16,100);
      drawPushButton(tf,10,30,0,0,"OK",true);
      drawPushButton(tf,10,55,0,0,"Cancel");
      drawInputField(tf,10,80,100,22);
      drawSpinButton(tf,10,110,100,22);
      drawSwitch(tf,10,140,64,22,"off");
      drawSwitch(tf,10,170,64,22,"on");
      drawCheckButton(tf,10,200,0,0,"Option","on");
      drawCheckButton(tf,10,230,0,0,"Option","mixed");
      drawCheckButton(tf,10,260,0,0,"Option","off");
      drawRadioButton(tf,10,290,0,0,"Option","on");
      drawRadioButton(tf,10,320,0,0,"Option","mixed");
      drawRadioButton(tf,10,350,0,0,"Option","off");
      drawRevealButton(tf,10,380,0,0,"More","closed");
      drawRevealButton(tf,10,410,0,0,"More","turning");
      drawRevealButton(tf,10,440,0,0,"More","open");
      drawOptionButton(tf,10,470,0,0,"Option");
      drawHLevel(tf,10,500,100,16)
      drawVLevel(tf,120,470,16,100)
      drawCutawayField(tf,170,10,118,118,true,true);
    </script>

    <input type="checkbox" id="showbounds"><label for="showbounds">Show Text Bounds</label>

    <table style="display: none; background-color: var(--base-fill-color)">
      <tr>
        <th>Widget</th>
        <th>Active</th>
        <th>Inactive (not done)</th>
      </tr>
      <tr><th>Button</th>
        <td>
          <svg width="200" height="100">
            <g class="button" transform="translate(68,39)">
              <rect x="0.5" y="0.5" width="64" height="22"/>
              <polyline points="1,21.5 63.5,21.5 63.5,1"/>
              <polyline points="1.5,22 1.5,1.5 64,1.5"/>
              <text class="centered" x="32" y="11">OK</text>
            </g>
          </svg>
        </td>
        <td>
          <svg width="200" height="100">
            <g transform="translate(68,39)">
              <rect x="0.5" y="0.5" width="64" height="22" fill="var(--raised-fill-color)" stroke="var(--outline-color)"/>
              <text class="centered" x="32" y="11">OK</text>
            </g>
          </svg>
        </td>
      </tr>
      <tr><th>Default Button</th>
        <td>
          <svg width="200" height="100">
            <g class="button" transform="translate(68,39)">
              <rect x="0.5" y="0.5" width="64" height="22"/>
              <polyline points="1,21.5 63.5,21.5 63.5,1"/>
              <polyline points="1.5,22 1.5,1.5 64,1.5"/>
              <text class="centered" x="32" y="11">OK</text>
              <rect x="-0.5" y="-0.5" width="66" height="24" fill="none" stroke="black"/>
            </g>
          </svg>
        </td>
        <td></td>
      </tr>
      <tr><th>Button Pressed</th>
        <td>
          <svg width="200" height="100">
            <g transform="translate(68,39)">
              <rect x="0.5" y="0.5" width="64" height="22" fill="#bbbbbb" stroke="var(--outline-color)"/>
              <polyline class="shadow" points="1.5,22 1.5,1.5 64,1.5"/>
              <polyline class="highlight" points="1,21.5 63.5,21.5 63.5,1"/>
              <text class="centered" x="32" y="11">OK</text>
            </g>
          </svg>
        </td>
        <td>
          <svg width="200" height="100">
            <g transform="translate(68,39)">
              <rect x="0.5" y="0.5" width="64" height="22" fill="#bbbbbb" stroke="var(--outline-color)"/>
              <text class="centered" x="32" y="11">OK</text>
            </g>
          </svg>
        </td>
      </tr>
      <tr><th>Switch (off)</th>
        <td>
          <svg width="200" height="100">
            <g class="switch" transform="translate(68,39)">
              <rect class="trough" x="0.5" y="0.5" width="64" height="22"/>
              <polyline points="1.5,22 1.5,1.5 64,1.5"/>
              <polyline points="1,21.5 63.5,21.5 63.5,1"/>
              <g class="slider">
                <rect x="0.5" y="0.5" width="32" height="22"/>
                <polyline points="1,21.5 31.5,21.5 31.5,1"/>
                <polyline points="1.5,22 1.5,1.5 31.5,1.5"/>
              </g>
              <text class="centered" x="48" y="11">OFF</text>
            </g>
          </svg>
        </td>
        <td></td>
      </tr>
      <tr><th>Switch (on)</th>
        <td>
          <svg width="200" height="100">
            <g class="switch" transform="translate(68,39)">
              <rect class="trough" x="0.5" y="0.5" width="64" height="22"/>
              <polyline points="1.5,22 1.5,1.5 64,1.5"/>
              <polyline points="1,21.5 63.5,21.5 63.5,1"/>
              <g class="slider" transform="translate(32,0)">
                <rect x="0.5" y="0.5" width="32" height="22"/>
                <polyline points="1,21.5 31.5,21.5 31.5,1"/>
                <polyline points="1.5,22 1.5,1.5 31.5,1.5"/>
              </g>
              <text class="centered" x="16" y="11">ON</text>
            </g>
          </svg>
        </td>
        <td></td>
      </tr>
      <tr><th>Text Field</th>
        <td>
          <svg width="200" height="100">
            <g class="textfield" transform="translate(28,38)">
              <polyline class="shadow" points="1.5,24 1.5,1.5 144,1.5"/>
              <polyline class="highlight" points="1,23.5 143.5,23.5 143.5,1"/>
              <rect x="2.5" y="2.5" width="140" height="20" fill="#ffffff" stroke="var(--outline-color)"/>
              <text x="8" y="12" text-anchor="start" alignment-baseline="central">Input</text>
            </g>
          </svg>
        </td>
        <td>
          <svg width="200" height="100">
            <g transform="translate(28,38)">
              <rect x="2.5" y="2.5" width="140" height="20" fill="#ffffff" stroke="var(--outline-color)"/>
              <text x="8" y="12" text-anchor="start" alignment-baseline="central">Input</text>
            </g>
          </svg>
        </td>
      </tr>
      <tr><th>Text Field Focused</th>
        <td>
          <svg width="200" height="100">
            <g transform="translate(28,38)">
              <rect x="0.5" y="0.5" width="144" height="24" stroke="var(--outline-color)" fill="var(--outline-color)"/>
              <rect x="2.5" y="2.5" width="140" height="20" fill="#ffffff" stroke="var(--outline-color)"/>
              <text x="8" y="12" text-anchor="start" alignment-baseline="central">Input</text>
            </g>
          </svg>
        </td>
         <td>
          <svg width="200" height="100">
            <g transform="translate(28,38)">
              <rect x="0.5" y="0.5" width="144" height="24" fill="var(--outline-color)" stroke="var(--outline-color)"/>
              <rect x="2.5" y="2.5" width="140" height="20" fill="#ffffff" stroke="var(--outline-color)"/>
              <text x="8" y="12" text-anchor="start" alignment-baseline="central">Input</text>
            </g>
          </svg>
        </td>
      </tr>
      <tr><th>Spinbutton</th>
        <td>
          <svg width="200" height="100">
            <g transform="translate(28,38)">
              <rect x="2.5" y="2.5" width="140" height="20" stroke="var(--outline-color)" fill="white"/>
              <polyline class="highlight" points="1,23.5 143.5,23.5 143.5,1"/>
              <polyline class="shadow" points="1.5,24 1.5,1.5 144,1.5"/>
              <g class="button" transform="translate(2,2)">
                <rect x="0.5" y="0.5" width="20" height="20"/>
                <polyline points="1,19.5 19.5,19.5 19.5,1"/>
                <polyline points="1.5,20 1.5,1.5 20,1.5"/>
                <use xlink:href="#minusSign" width="20" height="20"/>
                <!--<line x1="4.5" y1="10.5" x2="16.5" y2="10.5" stroke-width="2" stroke="black"/>-->
              </g>
              <text x="110" y="12" text-anchor="end" alignment-baseline="central">1</text>
              <g class="button" transform="translate(122,2)">
                <rect x="0.5" y="0.5" width="20" height="20"/>
                <polyline points="1,19.5 19.5,19.5 19.5,1"/>
                <polyline points="1.5,20 1.5,1.5 20,1.5"/>
                <use xlink:href="#plusSign" width="20" height="20"/>
                <!--<line x1="4.5" y1="10.5" x2="16.5" y2="10.5" stroke-width="2" stroke="red"/>
                <line x1="10.5" y1="4.5" x2="10.5" y2="16.5" stroke-width="2" stroke="red"/>-->
              </g>
            </g>
          </svg>
        </td>
        <td>
          <svg width="200" height="100">
            <g transform="translate(28,38)">
              <rect x="2.5" y="2.5" width="140" height="20" stroke="var(--outline-color)" fill="var(--raised-fill-color)"/>
              <line x1="6.5" y1="12.5" x2="18.5" y2="12.5" stroke-width="2" stroke="black"/>
              <rect x=22.5 y=2.5 width=100 height=20 stroke="var(--outline-color)" fill="white"/>
              <text x="110" y="12" text-anchor="end" alignment-baseline="central">1</text>
              <line x1="126.5" y1="12.5" x2="138.5" y2="12.5" stroke-width="2" stroke="black"/>
              <line x1="132.5" y1="6.5" x2="132.5" y2="18.5" stroke-width="2" stroke="black"/>
            </g>
          </svg>
        </td>
      </tr>
      <tr><th>Check Button (unchecked)</th>
        <td>
          <svg width="200" height="100">
            <g transform="translate(70.5,44.5)">
              <use xlink:href="#checkbox"/>
              <text x="16" y="10">Option</text>
            </g>
          </svg>
        </td>
        <td>
          <svg width="200" height="100">
            <g transform="translate(70.5,44.5)">
              <rect width="12" height="12" fill="var(--raised-fill-color)" stroke="var(--outline-color)"/>
              <text x="16" y="10">Option</text>
            </g>
          </svg>
        </td>
      </tr>
      <tr><th>Check Button (checked)</th>
        <td>
          <svg width="200" height="100">
            <g transform="translate(70.5,44.5)">
              <use xlink:href="#checkbox"/>
              <!-- <use xlink:href="#checkmark"/> -->
              <text class="centered" x="6" y="6" style="font-size: 18">✓</text>
              <text x="16" y="10">Option</text>
            </g>
          </svg>
        </td>
        <td>
          <svg width="200" height="100">
            <g transform="translate(70.5,44.5)">
              <rect width="12" height="12" fill="var(--raised-fill-color)" stroke="var(--outline-color)"/>
              <use xlink:href="#checkmark"/>
              <text x="16" y="10">Option</text>
            </g>
          </svg>
        </td>
      </tr>
      <tr><th>Check Button (mixed)</th>
        <td>
          <svg width="200" height="100">
            <g transform="translate(70.5,44.5)">
              <use xlink:href="#checkbox"/>
              <line x1="1.5" y1="6" x2="10.5" y2="6" stroke-width="2" stroke="#000"/>
              <text x="16" y="10">Option</text>
            </g>
          </svg>
        </td>
        <td>
          <svg width="200" height="100">
            <g transform="translate(70.5,44.5)">
              <rect width="12" height="12" fill="var(--raised-fill-color)" stroke="var(--outline-color)"/>
              <line x1="1.5" y1="6" x2="10.5" y2="6" stroke-width="2" stroke="#000"/>
              <text x="16" y="10">Option</text>
            </g>
          </svg>
        </td>
      </tr>
      <tr><th>Radio Button (unchecked)</th>
        <td>
          <svg width="200" height="100">
            <g transform="translate(70.5,44.5)">
              <use xlink:href="#radioCircle"/>
              <text x="16" y="10">Option</text>
            </g>
          </svg>
        </td>
        <td>
          <svg width="200" height="100">
            <g transform="translate(70.5,44.5)">
              <circle cx="6" cy="6" r="6" fill="var(--raised-fill-color)" stroke="var(--outline-color)"/>
              <text x="16" y="10">Option</text>
            </g>
          </svg>
        </td>
      </tr>
      <tr><th>Radio Button (checked)</th>
        <td>
          <svg width="200" height="100">
            <g transform="translate(70.5,44.5)">
              <use xlink:href="#radioCircle"/>
              <circle cx="6" cy="6" r="2" fill="#000" stroke="#000"/>
              <text x="16" y="10">Option</text>
            </g>
          </svg>
        </td>
        <td>
          <svg width="200" height="100">
            <g transform="translate(70.5,44.5)">
              <circle cx="6" cy="6" r="6" fill="var(--raised-fill-color)" stroke="var(--outline-color)"/>
              <circle cx="6" cy="6" r="2" fill="#000" stroke="#000"/>
              <text x="16" y="10">Option</text>
            </g>
          </svg>
        </td>
      </tr>
      <tr><th>Radio Button (mixed)</th>
        <td>
          <svg width="200" height="100">
            <g transform="translate(70.5,44.5)">
              <use xlink:href="#radioCircle"/>
              <line x1="1.5" y1="6" x2="10.5" y2="6" stroke-width="2" stroke="#000"/>
              <text x="16" y="10">Option</text>
            </g>
          </svg>
        </td>
        <td>
          <svg width="200" height="100">
            <g transform="translate(70.5,44.5)">
              <circle cx="6" cy="6" r="6" fill="var(--raised-fill-color)" stroke="var(--outline-color)"/>
              <line x1="1.5" y1="6" x2="10.5" y2="6" stroke-width="2" stroke="#000"/>
              <text x="16" y="10">Option</text>
            </g>
          </svg>
        </td>
      </tr>
      <tr><th>Reveal Button (closed)</th>
        <td>
          <svg width="200" height="100">
            <g transform="translate(70.5,44.5)">
              <path fill="var(--raised-fill-color)" stroke="var(--outline-color)" d="M3,0 V12 H4 L10,6 L4,0 Z"/>
              <path class="shadow" d="M4,11 L9,6"/>
              <path class="highlight" d="M4,11 V1 L9,6"/>
              <path fill="none" stroke="var(--outline-color)" d="M3,0 V12 H4 L10,6 L4,0 Z"/>
              <text x="16" y="10">More</text>
            </g>
          </svg>
        </td>
        <td>
          <svg width="200" height="100">
            <g transform="translate(70.5,44.5)">
              <path fill="var(--raised-fill-color)" stroke="var(--outline-color)" d="M3,0 V12 H4 L10,6 L4,0 Z"/>
              <text x="16" y="10">More</text>
            </g>
          </svg>
        </td>
      </tr>
      <tr><th>Reveal Button (opened)</th>
        <td>
          <svg width="200" height="100">
            <g transform="translate(70.5,44.5)">
              <g transform="rotate (90 6 6)">
                <path fill="var(--raised-fill-color)" stroke="var(--outline-color)" d="M3,0 V12 H4 L10,6 L4,0 Z"/>
                <path class="shadow" d="M9,6 L4,1"/>
                <path class="highlight" d="M 9,6 L4,11 V1"/>
                <path fill="none" stroke="var(--outline-color)" d="M3,0 V12 H4 L10,6 L4,0 Z"/>
              </g>
              <text x="16" y="10">More</text>
            </g>
          </svg>
        </td>
        <td>
          <svg width="200" height="100">
            <g transform="translate(70.5,44.5)">
              <path fill="var(--raised-fill-color)" stroke="var(--outline-color)" d="M3,0 V12 H4 L10,6 L4,0 Z" transform="rotate(90 6 6)"/>
              <text x="16" y="10">More</text>
            </g>
          </svg>
        </td>
      </tr>
      <tr><th>Reveal Button (turning)</th>
        <td>
          <svg width="200" height="100">
            <g transform="translate(70.5,44.5)">
              <g transform="rotate (45 6 6)">
                <path fill="var(--raised-fill-color)" stroke="var(--outline-color)" d="M3,0 V12 H4 L10,6 L4,0 Z"/>
                <path class="shadow" d="M4,11 L9,6 L4,1"/>
                <path class="highlight" d="M4,11 V1"/>
                <path fill="none" stroke="var(--outline-color)" d="M3,0 V12 H4 L10,6 L4,0 Z"/>
              </g>
              <text x="16" y="10">More</text>
            </g>
          </svg>
        </td>
        <td>
          <svg width="200" height="100">
            <g transform="translate(70.5,44.5)">
              <path fill="var(--raised-fill-color)" stroke="var(--outline-color)" d="M3,0 V12 H4 L10,6 L4,0 Z" transform="rotate(45 6 6)"/>
              <text x="16" y="10">More</text>
            </g>
          </svg>
        </td>
      </tr>
      <tr><th>Horizontal Scrollbar</th>
        <td>
          <svg width="200" height="100">
            <g transform="translate (0.5, 0.5)">
              <rect class="trough" width="160" height="16"/>
              <polyline class="shadow" points="1,15 1,1 127,1"/>
              <polyline class="highlight" points="1,15 127,15 127,1"/>
              <g class="button" transform="translate(128,0)">
                <rect width="16" height="16"/>
                <polyline points="1,15 15,15 15,1"/>
                <polyline points="1,15 1,1 15,1"/>
                <use xlink:href="#newArrowLeft" width="16" height="16"/>
              </g>
              <g class="button" transform="translate(144,0)">
                <rect width="16" height="16"/>
                <polyline points="1,15 15,15 15,1"/>
                <polyline points="1,15 1,1 15,1"/>
                <use xlink:href="#newArrowRight" width="16" height="16"/>
              </g>
              <g class="slider" transform="translate(50,0)">
                <rect width="32" height="16"/>
                <polyline points="1,15 31,15 31,1"/>
                <polyline points="1,15 1,1 31,1"/>
                <use x="10.5" y="2.5" xlink:href="#hGrippy"/>
              </g>
            </g>
          </svg>
        </td>
        <td>
          <svg width="200" height="100">
            <g transform="translate (0.5, 0.5)">
              <rect class="trough" width="160" height="16"/>
              <g transform="translate(128,0)">
                <rect width="16" height="16" stroke="var(--outline-color)" fill="var(--raised-fill-color)"/>
                <use xlink:href="#newArrowLeft" width="16" height="16"/>
              </g>
              <g transform="translate(144,0)">
                <rect width="16" height="16" stroke="var(--outline-color)" fill="var(--raised-fill-color)"/>
                <use xlink:href="#newArrowRight" width="16" height="16"/>
              </g>
              <g transform="translate(50,0)">
                <rect width="32" height="16" stroke="var(--outline-color)" fill="var(--raised-fill-color)"/>
                <use x="10.5" y="2.5" xlink:href="#hGrippy"/>
              </g>
            </g>
          </svg>
        </td>
      </tr>
      <tr><th>Vertical Scrollbar</th>
        <td>
          <svg width="200" height="200">
            <g transform="translate (0.5, 0.5)">
              <rect class="trough" width="16" height="160"/>
              <polyline class="shadow" points="1,127 1,1 15,1"/>
              <polyline class="highlight" points="1,127 15,127 15,1"/>
              <g class="button" transform="translate(0,128)">
                <rect width="16" height="16"/>
                <polyline points="1,15 15,15 15,1"/>
                <polyline points="1,15 1,1 15,1"/>
                <use xlink:href="#newArrowUp" width="16" height="16"/>
              </g>
              <g class="button" transform="translate(0,144)">
                <rect width="16" height="16"/>
                <polyline points="1,15 15,15 15,1"/>
                <polyline points="1,15 1,1 15,1"/>
                <use xlink:href="#newArrowDown" width="16" height="16"/>
              </g>
              <g class="slider" transform="translate(0,50)">
                <rect width="16" height="32"/>
                <polyline points="1,31 15,31 15,1"/>
                <polyline points="1,31 1,1 15,1"/>
                <use x="2.5" y="10.5" xlink:href="#vGrippy"/>
              </g>
            </g>
          </svg>
        </td>
        <td>
          <svg width="200" height="200">
            <g transform="translate (0.5, 0.5)">
              <rect class="trough" width="16" height="160"/>
              <g transform="translate(0,128)">
                <rect width="16" height="16" stroke="var(--outline-color)" fill="var(--raised-fill-color)"/>
                <use xlink:href="#newArrowUp" width="16" height="16"/>
              </g>
              <g transform="translate(0,144)">
                <rect width="16" height="16" stroke="var(--outline-color)" fill="var(--raised-fill-color)"/>
                <use xlink:href="#newArrowDown" width="16" height="16"/>
              </g>
              <g transform="translate(0,50)">
                <rect width="16" height="32" stroke="var(--outline-color)" fill="var(--raised-fill-color)"/>
                <use x="2.5" y="10.5" xlink:href="#vGrippy"/>
              </g>
            </g>
          </svg>
        </td>
      </tr>
      <tr><th>Menu Button or Option Button</th>
        <td>
          <svg width="200" height="100">
            <g transform="translate(57, 39)">
              <rect x="0.5" y="0.5" width="86" height="22" fill="var(--raised-fill-color)" stroke="var(--outline-color)"/>
              <polyline class="shadow" points="1.5,21.5 64.5,21.5 64.5,1.5"/>
              <polyline class="highlight" points="1.5,21.5 1.5,1.5 64.5,1.5"/>
              <text class="centered" x="32" y="11">Option</text>
              <use x="64.5" width="22" height="22" xlink:href="#newArrowDown"/>
              <polyline class="shadow" points="65.5,21.5 85.5,21.5 85.5,1.5"/>
              <polyline class="highlight" points="65.5,21.5 65.5,1.5 85.5,1.5"/>
            </g>
          </svg>
        </td>
        <td>
          <svg width="200" height="100">
            <g transform="translate(57, 39)">
              <rect x="0.5" y="0.5" width="86" height="22" fill="var(--raised-fill-color)" stroke="var(--outline-color)"/>
              <text class="centered" x="32" y="11">Option</text>
              <use x="64.5" width="22" height="22" xlink:href="#newArrowDown"/>
              <line x1="64.5" y1="1" x2="64.5" y2="22" stroke="#a0a0a0"/>
            </g>
          </svg>
        </td>
      </tr>
      <tr><th>Corner Grip</th>
        <td>
          <svg width="200" height="100">
            <rect x="100.5"y="50.5" width="16" height="16" fill="#cccccc" stroke="var(--outline-color)"/> 
            <use x="100" y="50" width="16" height="16" xlink:href="#newcornergrip"/>
          </svg>
        </td>
        <td></td>
      </tr>
      <tr><th>Horizontal Slider</th>
        <td>
          <svg width="200" height="100">
            <g transform="translate(50,33)">
              <rect class="trough" x="0.5" y="0.5" width="100" height="3"/>
              <polyline points="1.5,2.5 1.5,1.5 99.5,1.5"/>
              <polyline points="1.5,2.5 99.5,2.5 99.5,1.5"/>
              <g class="slider" transform="translate(45,-6)">
                <rect x="0.5" y="0.5" width="15" height="15"/>
                <polyline points="1.5,14.5 14.5,14.5 14.5,1.5"/>
                <polyline points="1.5,14.5 1.5,1.5 14.5,1.5"/>
                <use xlink:href="#hGrippy" x="3" y="3"/>
              </g>
            </g>
            <g transform="translate(50,66)">
              <rect class="trough" style="fill: var(--recessed-fill-color);" x="0.5" y="0.5" width="100" height="5"/>
              <polyline points="1.5,4.5 1.5,1.5 99.5,1.5"/>
              <polyline points="1.5,4.5 99.5,4.5 99.5,1.5"/>
              <rect fill="var(--outline-color)" stroke="none" x="2" y="2" width="45" height="2"/>
              <g class="slider" transform="translate(45,-6)">
                <rect x="0.5" y="0.5" width="15" height="15"/>
                <polyline points="1.5,14.5 14.5,14.5 14.5,1.5"/>
                <polyline points="1.5,14.5 1.5,1.5 14.5,1.5"/>
                <use xlink:href="#hGrippy" x="3" y="3"/>
              </g>
            </g>
          </svg>
        </td>
        <td></td>
      </tr>
      <tr><th>List</th>
        <td>
          <svg width="200" height="300">
            <g class="textfield" transform="translate(0.5,13.5)">
              <polyline points="18,269 18,52 120,52"/>
              <polyline points="18,269 120,269 120,52"/>
              <rect x="19" y="53" width="100" height="215"/>
              <text x="23" y="68">Program</text>
              <text x="23" y="88">Session</text>
              <text x="23" y="108">Association</text>
              <text x="23" y="128">Window</text>
              <text x="23" y="148">General</text>
            </g>
          </svg>
        </td>
        <td></td>
      </tr>
    </table>
    <br/>
    <svg width="400" height="300" id="openDialog"><title>Open Dialog</title>
      <script>
        drawBaseWindow(document.getElementById("openDialog"),0,0,400,300);
        drawOptionButton(document.getElementById("openDialog"),18,18,0,0,"$PWD");
        drawInputField(document.getElementById("openDialog"),18,58,364,183);
        drawVScrollBar(document.getElementById("openDialog"),365,59,16,180);
        drawPushButton(document.getElementById("openDialog"),236,260,0,0,"Cancel");
        drawPushButton(document.getElementById("openDialog"),318,260,0,0,"Open",true);
      </script>
    </svg>
    <svg width="400" height="300" id="saveDialog"><title>Save Dialog</title>
      <script>
        drawBaseWindow(document.getElementById("saveDialog"),0,0,400,300);
        drawOptionButton(document.getElementById("saveDialog"),18,18,0,0,"$PWD");
        drawInputField(document.getElementById("saveDialog"),18,58,364,142);
        drawInputField(document.getElementById("saveDialog"),18,220,364,22);
        drawPushButton(document.getElementById("saveDialog"),236,260,0,0,"Cancel");
        drawPushButton(document.getElementById("saveDialog"),318,260,0,0,"Save",true);
      </script>
    </svg>
    <svg width="400" height="300" id="programSettingsPanel"><title>Program Settings Panel</title>
      <script>
        drawBaseWindow(document.getElementById("programSettingsPanel"),0,0,400,300);
        drawHeaderBar(document.getElementById("programSettingsPanel"),0,0,400,300,"#documentIcon","Program Settings","Some informative subtext");
      </script>
      <g class="textfield" transform="translate(0.5,13.5)">
        <rect x="19" y="53" width="100" height="215"/>
        <polyline points="18,269 18,52 120,52"/>
        <polyline points="18,269 120,269 120,52"/>
        <text x="23" y="68">Program</text>
        <text x="23" y="88">Session</text>
        <text x="23" y="108">Association</text>
        <text x="23" y="128">Window</text>
        <text x="23" y="148">General</text>
      </g>
    </svg>
    <svg width="640" height="480" id="basicView"><title>Basic View</title>
      <script>
        drawBaseWindow(document.getElementById("basicView"),0,0,640,480);
        drawHeaderBar(document.getElementById("basicView"),0,0,640,480,"#documentIcon","Item Name","item view type");
        drawCutawayField(document.getElementById("basicView"),3,50,634,427,false,false);
      </script>
    </svg>
    <svg width="640" height="480" id="documentView"><title>Document Window</title>
      <script>
        drawBaseWindow(document.getElementById("documentView"),0,0,640,480);
        drawHeaderBar(document.getElementById("documentView"),0,0,640,480,"#documentIcon","Document Title","plain text");
        drawCutawayField(document.getElementById("documentView"),3,50,634,427,true,true);
      </script>
    </svg>
    <svg width="640" height="480" id="projectFolder"><title>Project Folder</title>
      <script>
        drawBaseWindow(document.getElementById("projectFolder"),0,0,640,480);
        drawHeaderBar(document.getElementById("projectFolder"),0,0,640,480,"#folderIcon","Project Title","source code");
      </script>
      <!-- <text class="centered" x="29" y="25" style="font-size: 48">🗀</text> -->
      <g transform="translate(4,51)">
        <rect x="0.5" y="0.5" width="160" height="424" stroke="var(--outline-color)" fill="white"/>
        <text x="1.5" y="13.5">🗀 doc</text>
        <text x="1.5" y="33.5">🗀 include</text>
        <text x="1.5" y="53.5">🗀 some folder</text>
        <text x="1.5" y="73.5">🗀 src</text>
        <rect x="0.5" y="79.5" width="160" height="20" fill="black" stroke="none"/>
        <text x="1.5" y="93.5" style="fill: white"> 🗎 README</text>
      </g>
      <rect x="160.5" y="51.5" width="459" height="424" stroke="var(--outline-color)" fill="white"/>
      <text x="165.5" y="71.5">Lorem ipsum dolor sit amet.</text>
      <g class="v-scrollbar" transform="translate(619.5,51.5)">
        <rect class="trough" width="16" height="376"/>
        <polyline class="shadow" points="1,375 1,1 15,1"/>
        <polyline class="highlight" points="1,375 15,375 15,1"/>
        <g class="button" transform="translate(0,376)">
          <rect width="16" height="16" stroke="var(--outline-color)" fill="var(--raised-fill-color)"/>
          <polyline points="1,15 15,15 15,1"/>
          <polyline points="1,15 1,1 15,1"/>
          <use xlink:href="#newArrowUp" width="16" height="16"/>
        </g>
        <g class="button" transform="translate(0,392)">
          <rect width="16" height="16" stroke="var(--outline-color)" fill="var(--raised-fill-color)"/>
          <polyline points="1,15 15,15 15,1"/>
          <polyline points="1,15 1,1 15,1"/>
          <use xlink:href="#newArrowDown" width="16" height="16"/>
        </g>
        <g class="slider" transform="translate(0,100)">
          <rect width="16" height="32"/>
          <polyline points="1,31 15,31 15,1"/>
          <polyline points="1,31 1,1 15,1"/>
          <use x="3" y="11" xlink:href="#vGrippy"/>
        </g>
      </g>
      <g class="h-scrollbar" transform="translate (160.5, 459.5)">
        <rect class="trough" width="427" height="16"/>
        <polyline class="shadow" points="1,15 1,1 426,1"/>
        <polyline class="highlight" points="1,15 426,15 426,1"/>
        <g class="button" transform="translate(427,0)">
          <rect width="16" height="16" stroke="var(--outline-color)" fill="var(--raised-fill-color)"/>
          <polyline points="1,15 15,15 15,1"/>
          <polyline points="1,15 1,1 15,1"/>
          <use xlink:href="#newArrowLeft" width="16" height="16"/>
        </g>
        <g class="button" transform="translate(443,0)">
          <rect width="16" height="16" stroke="var(--outline-color)" fill="var(--raised-fill-color)"/>
          <polyline points="1,15 15,15 15,1"/>
          <polyline points="1,15 1,1 15,1"/>
          <use xlink:href="#newArrowRight" width="16" height="16"/>
        </g>
        <g class="slider" transform="translate(100,0)">
          <rect width="32" height="16"/>
          <polyline points="1,15 31,15 31,1"/>
          <polyline points="1,15 1,1 31,1"/>
          <use x="11" y="3" xlink:href="#hGrippy"/>
        </g>
      </g>
      <polyline class="shadow" points="3.5,476.5 3.5,50.5 636.5,50.5"/>
      <polyline class="highlight" points="3.5,476.5 620.5,476.5 620.5,460.5 636.5,460.5 636.5,50.5"/>
    </svg>
    <svg width="640" height="480" id="spreadsheet"><title>Spreadsheet</title>
      <script>
        drawBaseWindow(document.getElementById("spreadsheet"),0,0,640,480);
        drawHeaderBar(document.getElementById("spreadsheet"),0,0,640,480,"#documentIcon","Document Title","spreadsheet");
      </script>
      <rect x="4.5" y="51.5" width="631" height="424" stroke="var(--outline-color)" fill="white"/>
      <rect x="620.5" y="460.5" width="16" height="16" stroke="none" fill="var(--base-fill-color)" />
      <polyline class="shadow" points="3.5,476.5, 3.5,50.5 636.5,50.5" />
      <polyline class="highlight" points="3.5,476.5 621.5,476.5 621.5,461.5 636.5,461.5 636.5,50.5"></polyline>
      <use x="622" y="462" xlink:href="#newcornergrip"/>
      <g transform="translate(4.5,460.5)"> <!-- tabs -->
        <rect width="180" height="15" fill="var(--base-fill-color)" stroke="var(--outline-color)"/>
        <path fill="#ffffff" stroke="var(--outline-color)" d="M0,0 H115 L120,13 H170 L175,0 H180"/>
        <text style="font-size: 10; font-family: Sans-serif; stroke: none; fill: black;" x="141" y="10">3</text>
        <path fill="#ffffff" stroke="var(--outline-color)" d="M0,0 H60 L65,13 H115 L120,0 H180"/>
        <text style="font-size: 10; font-family: Sans-serif; stroke: none; fill: black;" x="86" y="10">2</text>
        <path d="M1,0 H179" stroke="#ffffff"/>
        <path fill="#ffffff" stroke="var(--outline-color)" d="M0,0 H5 L10,13 H60 L65,0 H180"/>
        <text style="font-size: 10; font-family: Sans-serif; stroke: none; fill: black;" x="31" y="10">1</text>
      </g>
      <g transform="translate(4,51)">
        <rect x="0.5" y="0.5" width="631" height="27" fill="var(--base-fill-color)" stroke="var(--outline-color)"/>
        <polyline class="shadow" points="1,26.5 630.5,26.5 630.5,1"/>
        <polyline class="highlight" points="1.5,27 1.5,1.5 631,1.5"/>
      </g>
      <script>
        drawVScrollBar(document.getElementById("spreadsheet"),620,78,16,382);
        drawHScrollBar(document.getElementById("spreadsheet"),184,460,436,16);
        drawInputField(document.getElementById("spreadsheet"),82,54,500,22);
        drawButton(document.getElementById("spreadsheet"),10,54,22,22);
        drawButton(document.getElementById("spreadsheet"),34,54,22,22);
        drawButton(document.getElementById("spreadsheet"),58,54,22,22);
      </script>
    </svg>
    <svg width="640" height="480" id="spreadsheet2"><title>Spreadsheet</title>
      <script>
        drawBaseWindow(document.getElementById("spreadsheet2"),0,0,640,480);
        drawHeaderBar(document.getElementById("spreadsheet2"),0,0,0,0,"#documentIcon","Document Title","spreadsheet");
      </script>
      <rect x="4.5" y="51.5" width="616" height="382" stroke="var(--outline-color)" fill="white"/>
      <polyline class="shadow" points="3.5,449.5, 3.5,50.5 636.5,50.5" />
      <polyline class="highlight" points="3.5,449.5 621.5,449.5 621.5,434.5 636.5,434.5 636.5,50.5"></polyline>
      <g transform="translate(4.5,433.5)"> <!-- tabs -->
        <rect width="180" height="15" fill="var(--base-fill-color)" stroke="var(--outline-color)"/>
        <path fill="#ffffff" stroke="var(--outline-color)" d="M0,0 H115 L120,13 H170 L175,0 H180"/>
        <text style="font-size: 10; font-family: Sans-serif; stroke: none; fill: black;" x="141" y="10">3</text>
        <path fill="#ffffff" stroke="var(--outline-color)" d="M0,0 H60 L65,13 H115 L120,0 H180"/>
        <text style="font-size: 10; font-family: Sans-serif; stroke: none; fill: black;" x="86" y="10">2</text>
        <path d="M1,0 H179" stroke="#ffffff"/>
        <path fill="#ffffff" stroke="var(--outline-color)" d="M0,0 H5 L10,13 H60 L65,0 H180"/>
        <text style="font-size: 10; font-family: Sans-serif; stroke: none; fill: black;" x="31" y="10">1</text>
      </g>
      <script>
        drawVScrollBar(document.getElementById("spreadsheet2"),620,51,16,382);
        drawHScrollBar(document.getElementById("spreadsheet2"),184,433,436,16);
      </script>
      <g id="spreadsheet2-toolbar" transform="translate(0,450)">
        <script>
          drawButton(document.getElementById("spreadsheet2-toolbar"),4,3,22,22);
          drawButton(document.getElementById("spreadsheet2-toolbar"),28,3,22,22);
          drawButton(document.getElementById("spreadsheet2-toolbar"),52,3,22,22);
          drawInputField(document.getElementById("spreadsheet2-toolbar"),76,3,500,22);
        </script>
      </g>
      
    </svg>
    <svg width="640" height="480" id="controlConsole"><title>Control Console</title>
      <script>drawBaseWindow(document.getElementById("controlConsole"),0,0,640,480);</script>
      <rect x="1.5" y="1.5" width="48" height="48" stroke="none" fill="none"/>
      <text class="centered" x="25" y="25" style="font-size: 48">⚙</text>
      <text x="56" y="24" style="font-size: 24">Control System</text>
      <text x="56" y="41">some current status</text>
      <g transform="translate(160,80)">
        <g>
          <g class="textfield">
            <rect x="1.5" y="1.5" width="200" height="108" style="fill: var(--raised-fill-color)"/>
            <polyline points="0.5,110.5 0.5,0.5 202.5,0.5"/>
            <polyline points="0.5,110.5 202.5,110.5 202.5,0.5"/>
            <text x="1.5" y="-5.5" style="font-size: 24;">Detector Angle (2<tspan style="font-style:italic;">θ</tspan>)</text>
            <text x="200" y="89" style="font-size: 96; text-anchor: end;">32°</text>
          </g>
          <g class="button" transform="translate(212, 1)">
            <rect x="0.5" y="0.5" width="64" height="54"/>
            <polyline points="1.5,53.5 63.5,53.5 63.5,1.5"/>
            <polyline points="1.5,53.5 1.5,1.5 63.5,1.5"/>
            <use xlink:href="#newArrowUp" width="64" height="54"/>
          </g>
          <g class="button" transform="translate(212, 55)">
            <rect x="0.5" y="0.5" width="64" height="54"/>
            <polyline points="1.5,53.5 63.5,53.5 63.5,1.5"/>
            <polyline points="1.5,53.5 1.5,1.5 63.5,1.5"/>
            <use xlink:href="#newArrowDown" width="64" height="54"/>
          </g>
        </g>
        <g transform="translate(0, 151)">
          <g class="textfield">
            <rect x="1.5" y="1.5" width="200" height="108" style="fill: var(--raised-fill-color)"/>
            <polyline points="0.5,110.5 0.5,0.5 202.5,0.5"/>
            <polyline points="0.5,110.5 202.5,110.5 202.5,0.5"/>
            <text x="1.5" y="-5.5" style="font-size: 24;">Sample Angle (<tspan style="font-style:italic;">θ</tspan>)</text>
            <text x="200" y="89" style="font-size: 96; text-anchor: end;">16°</text>
          </g>
          <g class="button" transform="translate(212, 1)">
            <rect x="0.5" y="0.5" width="64" height="54"/>
            <polyline points="1.5,53.5 63.5,53.5 63.5,1.5"/>
            <polyline points="1.5,53.5 1.5,1.5 63.5,1.5"/>
            <use xlink:href="#newArrowUp" width="64" height="54"/>
          </g>
          <g class="button" transform="translate(212, 55)">
            <rect x="0.5" y="0.5" width="64" height="54"/>
            <polyline points="1.5,53.5 63.5,53.5 63.5,1.5"/>
            <polyline points="1.5,53.5 1.5,1.5 63.5,1.5"/>
            <use xlink:href="#newArrowDown" width="64" height="54"/>
          </g>
        </g>
        <path d="M280.5,55.5 h5 a 10 10 90 0,1 10 10 v55 m 0 21 v55 a 10 10 90 0,1 -10 10 h -5" stroke="var(--outline-color)" fill="none"/>
      </g>
    </svg>
    <svg width="1000" height="1000"><title>Playground</title>
      <rect x="0.5" y="0.5" width="999" height="999" stroke="var(--outline-color)" fill="var(--base-fill-color)"/>
      <use x="20" y="20" xlink:href="#documentIcon" fill="white" width="16" height="16"/>
      <use x="40" y="40" xlink:href="#folderIcon" fill="red" width="16" height="16"/>

      <use x="20.5" y="60.5" xlink:href="#sheetTabGroup" fill="red" width="16" height="16"/>
      <use x="75" y="100" xlink:href="#sheettab-inactive" fill="red" width="16" height="16"/>
      <use x="20" y="100" xlink:href="#sheettab-active" fill="red" width="16" height="16"/>

      <g transform="translate(100,200)" id="tabset1">
        <script>
          function drawTabs(parentElement,x,y,width,height,labels,activeIndex) {
            textLabels = labels.map(function (label) {
              var txt = document.createElementNS("http://www.w3.org/2000/svg","text");
              txt.innerHTML = label;
              txt.setAttribute("class","centered");
              txt.setAttribute("pointer-events","none");
              return txt;
            });
            var minh = 22;
            whs = textLabels.map(function(tl) {
              var w = 64;
              var h = 22;
              var box = tl.getBBox();
              if (box.width > w+12) w=box.width+12;
              if (box.height > h+5) h=box.height+5;
              if (h>minh) minh=h;
              return [w,h];
            });
            whs.forEach(function(wh,i,a) { wh[1] = (i==activeIndex)?minh+1:minh; });

            var currentX = 0;

            xywhs = whs.map(function(wh,i,a) {
              var localY = (i==activeIndex)?0:1;
              var lastX = currentX;
              currentX = currentX+wh[0]-1;
              return [lastX,localY,wh[0],wh[1]];
            });
            console.log(xywhs);

            var l = document.createElementNS("http://www.w3.org/2000/svg","rect");
            l.setAttribute("x",x+0.5);
            l.setAttribute("y",y+minh+0.5);
            l.setAttribute("width",width-1);
            l.setAttribute("height",height-minh-1);
            l.setAttribute("fill","var(--base-fill-color)");
            l.setAttribute("stroke","var(--outline-color)");
            parentElement.insertAdjacentElement("beforeend",l);

            var os = document.createElementNS("http://www.w3.org/2000/svg","polyline");
            os.setAttribute("class","shadow");
            os.setAttribute("points",""+(x+1.5)+","+(y+height-1.5)+" "+(x+width-1.5)+","+(y+height-1.5)+" "+(x+width-1.5)+","+(y+minh+1.5));
            parentElement.insertAdjacentElement("beforeend",os);

            var oh = document.createElementNS("http://www.w3.org/2000/svg","polyline");
            oh.setAttribute("class","highlight");
            oh.setAttribute("points",""+(x+1.5)+","+(y+height-1)+" "+(x+1.5)+","+(y+minh+1.5)+" "+(x+width-1)+","+(y+minh+1.5));
            parentElement.insertAdjacentElement("beforeend",oh);

            currentX = 0;
            textLabels.forEach(function(tl,i,a) {
              var g = document.createElementNS("http://www.w3.org/2000/svg","g");
              g.setAttribute("transform","translate("+(x+currentX)+","+y+")");
              parentElement.insertAdjacentElement("beforeend",g);

              var localY = (i==activeIndex)?0.5:1.5;

              var r = document.createElementNS("http://www.w3.org/2000/svg","rect");
              r.setAttribute("x",0.5);
              r.setAttribute("y", localY);
              r.setAttribute("width",whs[i][0]-1);
              r.setAttribute("height",whs[i][1]-1);
              r.setAttribute("fill", (i==activeIndex)?"var(--base-fill-color)":"var(--recessed-fill-color)");
              r.setAttribute("stroke","var(--outline-color)");
              g.insertAdjacentElement("beforeend",r);

              var s = document.createElementNS("http://www.w3.org/2000/svg","polyline");
              s.setAttribute("class","shadow");
              s.setAttribute("points",""+(whs[i][0]-1.5)+","+(localY+whs[i][1]-1.5)+" "+(whs[i][0]-1.5)+","+(localY+1));
              g.insertAdjacentElement("beforeend",s);

              var h = document.createElementNS("http://www.w3.org/2000/svg","polyline");
              h.setAttribute("class","highlight");
              h.setAttribute("points",""+1.5+","+(localY+whs[i][1]-1.5)+" "+1.5+","+(localY+1)+" "+(whs[i][0]-1)+","+(localY+1));
              g.insertAdjacentElement("beforeend",h);

              if (i==activeIndex) {
                var p1 = document.createElementNS("http://www.w3.org/2000/svg","polyline");
                p1.setAttribute("fill","none");
                p1.setAttribute("stroke", "var(--base-fill-color)");
                p1.setAttribute("points","1.5,"+(localY+whs[i][1]-1)+" "+(whs[i][0]-1)+","+(localY+whs[i][1]-1));
                g.insertAdjacentElement("beforeend",p1);
                var p2 = document.createElementNS("http://www.w3.org/2000/svg","polyline");
                p2.setAttribute("fill","none");
                p2.setAttribute("stroke", "var(--base-fill-color)");
                p2.setAttribute("points","1.5,"+(localY+whs[i][1])+" "+(whs[i][0]-1)+","+(localY+whs[i][1]));
                g.insertAdjacentElement("beforeend",p2);
              }


              tl.setAttribute("x",whs[i][0]/2);
              tl.setAttribute("y",(whs[i][1]/2) + ((i==activeIndex)?0:1));
              g.insertAdjacentElement("beforeend",tl);

              currentX = currentX+whs[i][0]-1;
            });

            var xywh = xywhs[activeIndex];
            var corners = [
              [x+xywh[0]+0.5,         y+xywh[1]+0.5],         // tabtopleft
              [x+xywh[0]+xywh[2]-0.5, y+xywh[1]+0.5],         // tabtopright
              [x+xywh[0]+xywh[2]-0.5, y+xywh[1]+xywh[3]-1.5], // tabbottomright
              [x+width-0.5,           y+xywh[1]+xywh[3]-1.5], //sheettopright
              [x+width-0.5,           y+height-0.5],          //sheetbottomright
              [x+0.5,                 y+height-0.5],          //sheetbottomleft
              [x+0.5,                 y+xywh[1]+xywh[3]-1.5], //sheettopleft
              [x+xywh[0]+0.5,         y+xywh[1]+xywh[3]-1.5]  //tabbottomleft
            ]

            /* Draw tabbed sheet. Draw side "buttons". */
            var tsp = document.createElementNS("http://www.w3.org/2000/svg","path");
            tsp.setAttribute("fill","var(--base-fill-color)");
            tsp.setAttribute("stroke", "red"); //"var(--outline-color)");
            tsp.setAttribute("d","M"+corners[0][0]+","+corners[0][1]
                              + " H"+corners[1][0]
                              + " V"+corners[2][1]
                              + " H"+corners[3][0]
                              + " V"+corners[4][1]
                              + " H"+corners[5][0]
                              + " V"+corners[6][1]
                              + " H"+corners[7][0]
                              + " Z");
            parentElement.insertAdjacentElement("beforeend",tsp);

            var tsps = document.createElementNS("http://www.w3.org/2000/svg","path");
            tsps.setAttribute("fill","none");
            tsps.setAttribute("stroke","var(--shadow-stroke-color)");
            tsps.setAttribute("d","M"+(corners[0][0]+1)+","+(corners[0][1]+1)
                               + " H"+(corners[1][0]-1)
                               + " V"+(corners[2][1]+1)
                               + " H"+(corners[3][0]-1)
                               + " V"+(corners[4][1]-1)
                               + " H"+(corners[5][0]+1)
                               + " V"+(corners[6][1]+1)
                               + " H"+(corners[7][0]+1)
                               + " Z");
            parentElement.insertAdjacentElement("beforeend",tsps);
            var tsph = document.createElementNS("http://www.w3.org/2000/svg","path");
            tsph.setAttribute("fill","none");
            tsph.setAttribute("stroke","green");//"var(--highlight-stroke-color)");
            tsph.setAttribute("d","M"+(corners[0][0]+1)+","+(corners[0][1]+1)
                               + " H"+(corners[1][0]-1)
                               + " M"+(corners[2][0]-1)+","+(corners[2][1]+1)
                               + " H"+(corners[3][0]-1)
                               + " M"+(corners[4][0]-1)+","+(corners[4][1]+1)
                               + " M"+(corners[5][0]+1)+","+(corners[5][1]+1)
                               + " V"+(corners[6][1]+1)
                               + " H"+(corners[7][0]+1)
                               + " L"+(corners[0][0]+1)+","+(corners[0][1]+1));
            parentElement.insertAdjacentElement("beforeend",tsph);
          }
          drawTabs(document.getElementById("tabset1"),0,0,240,28,["a","b","c"],0);
          drawTabs(document.getElementById("tabset1"),0,30,240,28,["a","b","c"],1);
          drawTabs(document.getElementById("tabset1"),0,60,240,28,["a","b","c"],2);
        </script>
        <!-- <rect fill="none" x="0.5" y="0.5" width="239" height="79" stroke="var(--outline-color)"/>

        <path d="M0.5,24.5 h10 v-22 h63 v22 H239.5" stroke="var(--outline-color)" fill="var(--raised-fill-color)" />
        <path d="M73.5,3.5 h63 v21" stroke="var(--outline-color)" fill="none" />
        <path d="M136.5,3.5 h63 v21" stroke="var(--outline-color)" fill="none" />

        <path d="M72.5,3.5 v21.5" stroke="var(--shadow-stroke-color)" fill="none" />
        <path d="M135.5,4.5 v19.5" stroke="var(--shadow-stroke-color)" fill="none" />
        <path d="M198.5,4.5 v19.5" stroke="var(--shadow-stroke-color)" fill="none" />
        
        <path d="M74,4.5 h62" stroke="var(--highlight-stroke-color)" fill="none"/>
        <path d="M137,4.5 h62" stroke="var(--highlight-stroke-color)" fill="none"/>

        <path d="M1.5,78.5 H238.5 V25.5" stroke="var(--shadow-stroke-color)" fill="none" />
        <path d="M1.5,78.5 V25.5 h10 v-22 h61.5 m-1,22 H238.5" stroke="var(--highlight-stroke-color)" fill="none"/>
        -->
        <!--<rect x="10.5" y="2.5" width="63" height="21" fill="#ffff0080" stroke="#ff000080" />
        <rect x="73.5" y="2.5" width="63" height="21" fill="#ffff0080" stroke="#ff000080" />
        <rect x="136.5" y="2.5" width="63" height="21" fill="#ffff0080" stroke="#ff000080" />-->
      </g>
      <g transform="translate(100,300)">
        <rect fill="none" x="0.5" y="0.5" width="239" height="79" stroke="var(--outline-color)"/>

        <path d="M0.5,24.5 h10 v-21 h63" stroke="var(--outline-color)" fill="none" />
        <path d="M0.5,24.5 h73 v-22 h63 v22 H239.5" stroke="var(--outline-color)" fill="var(--raised-fill-color)" />
        <path d="M136.5,3.5 h63 v21" stroke="var(--outline-color)" fill="none" />

        <path d="M135.5,3.5 v21.5" stroke="var(--shadow-stroke-color)" fill="none" />
        <path d="M198.5,4.5 v19.5" stroke="var(--shadow-stroke-color)" fill="none" />
        
        <path d="M11.5,24 v-19.5 h61.5" stroke="var(--highlight-stroke-color)" fill="none"/>
        <path d="M74,3.5 h62" stroke="var(--highlight-stroke-color)" fill="none"/>
        <path d="M137,4.5 h62" stroke="var(--highlight-stroke-color)" fill="none"/>

        <path d="M1.5,78.5 H238.5 V25.5" stroke="var(--shadow-stroke-color)" fill="none" />
        <path d="M1.5,78.5 V25.5 h73 v-22 h61.5 m-1,22 H238.5" stroke="var(--highlight-stroke-color)" fill="none"/>

        <!--<rect x="10.5" y="2.5" width="63" height="21" fill="#ffff0080" stroke="#ff000080" />
        <rect x="73.5" y="2.5" width="63" height="21" fill="#ffff0080" stroke="#ff000080" />
        <rect x="136.5" y="2.5" width="63" height="21" fill="#ffff0080" stroke="#ff000080" />-->
      </g>
      <g transform="translate(100,400)">
        <rect fill="none" x="0.5" y="0.5" width="239" height="79" stroke="var(--outline-color)"/>

        <path d="M0.5,24.5 h10 v-21 h63 v21" stroke="var(--outline-color)" fill="none" />
        <path d="M73.5,3.5 h63 v21" stroke="var(--outline-color)" fill="none" />
        <path d="M0.5,24.5 h136 v-22 h63 v22 H239.5" stroke="var(--outline-color)" fill="var(--raised-fill-color)" />

        <path d="M198.5,3.5 v21.5" stroke="var(--shadow-stroke-color)" fill="none" />
        
        <path d="M11.5,24 v-19.5 h61.5" stroke="var(--highlight-stroke-color)" fill="none"/>
        <path d="M74.5,24 v-19.5 h61.5" stroke="var(--highlight-stroke-color)" fill="none"/>

        <path d="M1.5,78.5 H238.5 V25.5" stroke="var(--shadow-stroke-color)" fill="none" />
        <path d="M1.5,78.5 V25.5 h136 v-22 h61.5 m-1,22 H238.5" stroke="var(--highlight-stroke-color)" fill="none"/>

        <!--<rect x="10.5" y="2.5" width="63" height="21" fill="#ffff0080" stroke="#ff000080" />
        <rect x="73.5" y="2.5" width="63" height="21" fill="#ffff0080" stroke="#ff000080" />
        <rect x="136.5" y="2.5" width="63" height="21" fill="#ffff0080" stroke="#ff000080" />-->
      </g>

    </svg>

    <div style="background-color: black; padding: 10px; width: fit-content">
      <svg width="800" height="600"><title>Desktop 0</title>
        <rect width="800" height="600" fill="#5d1803"/>
        <rect width="800" height="22" fill="var(--raised-fill-color)"/>
        <text x="6" y="16" >⚙&nbsp;&nbsp;&nbsp;File&nbsp;&nbsp;&nbsp;Edit&nbsp;&nbsp;&nbsp;View&nbsp;&nbsp;&nbsp;Help</text>
        <text x="730" y="16" >12:00 PM</text>
        <g transform="translate(100,100)">
          <!-- icon -->
          <use xlink:href="#folderIcon" fill="#c7a534" width="48" height="48"/>
          <!-- text -->
          <text class="centered" x="24" y="56" style="fill:white">Some Folder</text>
        </g>
        <g transform="translate(100,200)">
          <!-- icon -->
          <use xlink:href="#documentIcon" fill="white" width="48" height="48"/>
          <!-- text -->
          <text class="centered" x="24" y="56" style="fill:white">Some File</text>
        </g>
        <g transform="translate(24,520)">
          <!-- icon -->
          <use xlink:href="#folderIcon" fill="#c7a534" width="48" height="48"/>
          <!-- text -->
          <text class="centered" x="24" y="56" style="fill:white">Templates</text>
        </g>
      </svg>
    </div>
    <div style="background-color: black; padding: 10px; width: fit-content">
      <svg width="800" height="600"><title>Desktop 1</title>
        <rect width="800" height="600" fill="#5d1803"/>
        <rect width="800" height="22" fill="var(--raised-fill-color)"/>
        <text x="6" y="16" >⚙&nbsp;&nbsp;&nbsp;File&nbsp;&nbsp;&nbsp;Edit&nbsp;&nbsp;&nbsp;View&nbsp;&nbsp;&nbsp;Help</text>
        <text x="730" y="16" >12:00 PM</text>
        <g transform="translate(100,100)">
          <!-- icon -->
          <use xlink:href="#folderIcon" fill="#c7a534" width="48" height="48"/>
          <!-- text -->
          <text class="centered" x="24" y="56" style="fill:white">Some Folder</text>
        </g>
        <g transform="translate(100,200)">
          <!-- icon -->
          <use xlink:href="#documentIcon" fill="white" width="48" height="48"/>
          <!-- text -->
          <text class="centered" x="24" y="56" style="fill:white">Some File</text>
        </g>
        <g transform="translate(24,520)">
          <!-- icon -->
          <use xlink:href="#folderIcon" fill="#c7a534" width="48" height="48"/>
          <!-- text -->
          <text class="centered" x="24" y="56" style="fill:white">Templates</text>
        </g>
        <svg x="120" y="50" width="660" height="500"><title>Templates Folder</title>
          <defs>
            <filter id="f1" x="0" y="0">
              <feGaussianBlur in="SourceGraphic" stdDeviation="5" />
            </filter>
          </defs>
          <rect x="0" y="0" width="660" height="500" stroke="none" fill="lightgrey" filter="url(#f1)" style="display: none;"></rect>
          <g transform="translate(10,10)">
            <rect x="-4.5" y="-4.5" width="649" height="489" stroke="var(--outline-color)" fill="var(--base-fill-color)"/>
            <polyline class="shadow" points="-3.5,483.5 643.5,483.5 643.5,-3.5"/>
            <polyline class="highlight" points="-3.5,483.5 -3.5,-3.5 643.5,-3.5"/>
            <rect x="1.5" y="1.5" width="48" height="48" stroke="none" fill="none"/>
            <!-- <use xlink:href="#folderIcon" x="1" y="1" width="48" height="48" fill="#aaaaaa"/> -->
            <text class="centered" x="25" y="25" style="font-size: 48">🗀</text>
            <text x="56" y="24" style="font-size: 24">Templates</text>
            <text x="56" y="41">Something something</text>
            <g transform="translate(0,51)">
              <rect x="0.5" y="0.5" width="160" height="428" stroke="var(--outline-color)" fill="white"/>
              <text x="1.5" y="13.5">🗀 System</text>
              <text x="1.5" y="33.5">🗀 Office</text>
            </g>
            <rect x="160.5" y="51.5" width="463" height="428" stroke="var(--outline-color)" fill="white"/>
            <polyline class="shadow" points="1.5,50.5 638.5,50.5"/>
            <g class="v-scrollbar" transform="translate(623.5,51.5)">
            <rect class="trough" width="16" height="396"/>
            <polyline class="shadow" points="1,379 1,1 15,1"/>
            <polyline class="highlight" points="1,379 15,379 15,1"/>
            <g class="button" transform="translate(0,380)">
              <rect width="16" height="16" stroke="var(--outline-color)" fill="var(--raised-fill-color)"/>
              <polyline points="1,15 15,15 15,1"/>
              <polyline points="1,15 1,1 15,1"/>
              <use xlink:href="#newArrowUp" width="16" height="16"/>
            </g>
            <g class="button" transform="translate(0,396)">
              <rect width="16" height="16" stroke="var(--outline-color)" fill="var(--raised-fill-color)"/>
              <polyline points="1,15 15,15 15,1"/>
              <polyline points="1,15 1,1 15,1"/>
              <use xlink:href="#newArrowDown" width="16" height="16"/>
            </g>
            <g class="slider" transform="translate(0,100)">
              <rect width="16" height="32"/>
              <polyline points="1,31 15,31 15,1"/>
              <polyline points="1,31 1,1 15,1"/>
              <use x="3" y="11" xlink:href="#vGrippy"/>
            </g>
            </g>
            <use x="623" y="463" xlink:href="#newcornergrip"/>
            <g class="h-scrollbar" transform="translate (160.5, 463.5)">
            <rect class="trough" width="447" height="16"/>
            <polyline class="shadow" points="1,15 1,1 430,1"/>
            <polyline class="highlight" points="1,15 430,15 430,1"/>
            <g class="button" transform="translate(431,0)">
              <rect width="16" height="16" stroke="var(--outline-color)" fill="var(--raised-fill-color)"/>
              <polyline points="1,15 15,15 15,1"/>
              <polyline points="1,15 1,1 15,1"/>
              <use xlink:href="#newArrowLeft" width="16" height="16"/>
            </g>
            <g class="button" transform="translate(447,0)">
              <rect width="16" height="16" stroke="var(--outline-color)" fill="var(--raised-fill-color)"/>
              <polyline points="1,15 15,15 15,1"/>
              <polyline points="1,15 1,1 15,1"/>
              <use xlink:href="#newArrowRight" width="16" height="16"/>
            </g>
            <g class="slider" transform="translate(100,0)">
              <rect width="32" height="16"/>
              <polyline points="1,15 31,15 31,1"/>
              <polyline points="1,15 1,1 31,1"/>
              <use x="11" y="3" xlink:href="#hGrippy"/>
            </g>
            </g>
          </g>
        </svg>
      </svg>
    </div>

    <script>
      function drawtextbounds () {
        var ts = document.getElementsByTagName("text");
        for (var i=0;i<ts.length;i++) {
          var box = ts[i].getBBox();
          var nr = document.createElementNS("http://www.w3.org/2000/svg","rect");
          nr.setAttribute("x", box.x);
          nr.setAttribute("y", box.y);
          nr.setAttribute("width", box.width);
          nr.setAttribute("height", box.height);
          nr.setAttribute("style", "fill: #ff000080; stroke:none;");
          nr.setAttribute("class","textbounds");
          nr.setAttribute("visibility","hidden");
          ts[i].insertAdjacentElement("afterend", nr);
        }
      }
      drawtextbounds();
      var cb = document.getElementById("showbounds");
      cb.addEventListener("change", () => {
        var tbs = document.getElementsByClassName("textbounds");
        for (var i=0;i<tbs.length;i++) {
          if(cb.checked) {
            tbs[i].setAttribute("visibility","visible");
          } else {
            tbs[i].setAttribute("visibility","hidden");
          }
        }
      });
    </script>
    <header>
      <h1>Make Templates. Make Items. Make Views. Make Property Pages.</h1>
      <p>Don't make applications.</p>
    </header>
    <p>This shell is different from what you're used to. While many elements will be familiar, they may work differently from how they do on other systems. Most graphical shells on Linux can be called thin shells; they strongly resemble the underlying system. This shell is a thick shell. The default is to portray what a casual user expects, which may be different from the underlying system. This kind of abstraction is already familiar if you consider that a text shell in a terminal doesn't tell you anything about the semiconductors in the underlying hardware.</p>
    <section><h2>Parts of the Shell</h2>
      <p>The principle abstraction of this shell is the item. Items come in a variety of types and new types can be easily created. Items are parts of the user's model of the system.</p>
      <section style="margin-left: 20%; margin-right: 20%;"><h3>Items</h3>
        <p>The shell provides a graphical user interface to a variety of items. Items are the objects of the graphical user interface. They may correspond to programmatic objects, but they may also be abstractions that unite various parts of the operating system. Every item has metadata. Item metadata includes the item's name, its icon, its media types, screen locations for its views, the files it represents, and more.</p>
      </section>
      <p>Some items are containers of other items. More on those later.</p>
      <p>An item is an abstract concept. The shell represents items graphically in views, which allow items to be manipulated and changed. A few of the shell graphics are not views of items, but are overlays on the screen.</p>
      <section style="margin-left: 20%; margin-right: 20%;"><h3>Views</h3>
        <p>Each of the various graphical representations of an item is a view. The item icon is the simplest view. The item property panel is another. Every item has these two views. Most items have more views. Some items may have surprising views. For example, an OpenDocument file has its default view in an office program, but it also has a folder view because its contents are a zipped archive of other files.</p>
        <p>On other systems, a view might be considered the main interface of an application.</p>
      </section>
      <section style="margin-left: 20%; margin-right: 20%;"><h3>Overlays</h3>
        <p>Overlays can be regarded as peripheral devices that extend onto the screen. The most obvious of these is the menu bar, which is usually present at the top of the screen. The menu bar also contains some system status indicators. Notifications will also appear in overlays.</p>
      </section>
      <p>Every item has at least two views: its icon and its property panel.</p>
      <section style="margin-left: 20%; margin-right: 20%;"><h3>Icons</h3>
        <p>Every item has an icon view. It is, as the name implies, an icon. The icon view may have indicators of the item's status, such as hatch marks indicating another item view is open.</p>
      </section>
      <section style="margin-left: 20%; margin-right: 20%;"><h3>Property Panels</h3>
        <p>Every item has a property panel which allows viewing and editing some of the item's metadata. Panels are divided into pages. The "General" page applies to all items as it shows the item icon and name. Additional pages depend on the type of item being viewed.</p>
      </section>
      <p>Some items contain other items. The most basic container is a folder.</p>
      <section style="margin-left: 20%; margin-right: 20%;"><h3>Folders</h3>
        <p>Folders are items that contain other items, much like a directory contains files. Simple folders are just graphical representations of directories. More complicated types of folders exist.</p>
      </section>
      <section style="margin-left: 20%; margin-right: 20%;"><h3>Workspaces</h3>
        <p>A workspace is a special kind of folder. A simple workspace may represent a filesystem directory, but it also has information about the state of items inside it. The views of items in a workspace folder are connected to the folder view of the workspace. If the folder view closes, the item views close too. When the folder view is opened, the previously open items in the workspace reopen. It's a simple form of session management.</p>
      </section>
      <section style="margin-left: 20%; margin-right: 20%;"><h3>Desktops</h3>
        <p>Desktops are special workspaces. When a desktop is opened, its folder view becomes the background of the shell. Signing on to the system is really just opening your primary desktop, and signing out is closing it. Because the desktop is a workspace, any items that were open when it was last closed will be opened again when it's reopened.</p>
      </section>
      <p>(The system sign-on screen should perhaps show closed primary desktop folders, to maintain the item-oriented interface.)</p>
      <p>The first thing you see on the screen after signing on, aside from the menu bar overlay, is a desktop item. It's a folder that forms the background of the screen. The starting desktop contains a few items: a trash can, something something, and a templates folder.</p>
      <section style="margin-left: 20%; margin-right: 20%;"><h3>Templates</h3>
        <p>Templates are a special kind of item. When you drag and drop from a template icon, you get a new item of a kind specified by the template. For example, there is a folder template. Dragging and dropping from this template creates a new folder. There's a template for almost every kind of item you can create. One exception is a template itself; there's no template template. Templates can be created from existing items by dragging their icons into the template folder.</p>
        <p>Templates can have content. If you create a template from a word processor document, then new items made from that template will have the same content as the document did when the template was created. This is an easy way to make form letters, for example. If a folder with content is turned into a template, all of the folder's contents will be reproduced by dragging from that template.</p>
      </section>
      <p>Perhaps the default templates should be listed.</p>
      <p>Items, Views, Overlays, Icons, Property Panels, Folders, Workspaces, Desktops, Templates: Those are the basis of the entire system.</p>
      <ul>
        <li>Items
          <ul>
            <li>Simple types</li>
            <li>Container Types
              <ul>
                <li>Folders</li>
                <li>Workspaces</li>
                <li>Desktops</li>
              </ul>
            </li>
            <li>Templates</li>
          </ul>
        </li>
        <li>Views
          <ul>
            <li>Icons</li>
            <li>Property Panels</li>
            <li>Other</li>
          </ul>
        </li>
        <li>Overlays
          <ul>
            <li>Menu Bar</li>
            <li>Zoom Out</li>
            <li>Notifications</li>
            <li>Notification Center</li>
          </ul>
        </li>
      </ul>
    </section>
    <section><h2>Differences from Other GUIs</h2>
      <p>Some differences from other graphical user interfaces, especially those on Linux, should already be apparent.</p>
      <p>There are three applications on Linux that are reimagined in this shell: the window manager, the file manager, and the session manager.</p>
      <p>The window manager does very little in the normal order of things. It keeps overlays, including the menu bar, on top, and it keeps desktops on the bottom. It provides switching between desktops and keyboard-based switching between windows. It does not draw window frames, but it may provide effects like shadows. It does not reparent windows. It may provide a virtual desktop which is larger than the screen. It provides a window switching overlay. In the event of a window being closed, it ensures the right window has keyboard focus. Mouse-based focus is managed by the windows themselves using the globally active input model of the ICCCM. It may restrict the movement and placement of windows, but it mostly respects what clients give it. (The constraints on movements should suffice to constrain placement, because windows will only ask to be placed where they were before.) Window stacking order has some contraints, to keep overlays and desktops right, but clients are expected to raise their windows appropriately.</p>
      <p>The file manager is mostly replaced by folders. Browsing the file system, as with most modern file managers, is relegated to a utility which most users won't need. The user model of items and folders is preferred by the GUI over the programmer's model of files and directories.</p>
    </section>
    <section><h2>Notes on Folders</h2>
      <p>Folders should tend to be shallow. They're for the user's work, not for viewing the entirety of a unix filesystem. Some of the natural depth should be swept into projects which open into project views instead of folder views.</p>
      <p>Folders should tend to be small. Folders containing lots of similar items should probably have another view which manages the size of folder.</p>
      <p>When folders get large or deep, there may be a need for a new kind of view.</p>
      <p>Folders provide screen positions for both icons and views to opening views. These positions are shared with the window manager which may then animate the transition from an icon to another view. If the folder for an item is closed when the non-icon view is still visible, then the animation closing the open view will show it going to the containing folder's icon. If that icon is not visible, it will go to the next containing folder's icon, and so forth down to an icon on the desktop. (How?)</p>
      <p>A workspace item combines file and session management functions. As a file manager, it displays icons for its contents. As a session manager, it keeps track of other views of its contents.</p>
    </section>
    <section><h2>Expectations of Views</h2>
      <ul>
        <li>(Registration?)</li>
        <li>Opening
          <ul>
            <li>Will receive timestamp</li>
            <li>Will receive icon position</li>
            <li>Communicate with session manager</li>
            <li>Communicate with window manager. Icon position should be provided before mapping.</li>
            <li>Request focus using timestamp. Focus is not guaranteed.</li>
          </ul>
        </li>
        <li>Presenting
          <ul>
            <li>Raise window if focused and show and raise secondary windows as needed.</li>
            <li>Move and resize or tell WM to move and resize?</li>
            <li>Draw controls to match state. Background window controls should be disabled if they do not process the click that grants focus.</li>
            <li>Update view geometry metadata.</li>
          </ul>
        </li>
        <li>Closing
          <ul>
            <li>Update view geometry metadata.</li>
            <li>Communicate with session manager.</li>
          </ul>
        </li>
      </ul>
      <p>Views are responsible for communicating with the window manager and their session manager. To present a window, a view must communicate to the window manager the position information it receives when opened. This information includes icon positions in container windows between the view and the desktop. The view will also receive a timestamp corresponding to the event which opened the view and must use this timestamp to set focus when its window is mapped. Focus is not guaranteed! If another view has received focus in between the opening event and the mapping of the window, then it will not receive focus. If and when the window does receive focus, it should ask to be raised.</p>
      <p>(Default stacking position, controlled by the window manager, should be above the container window communicated in the startup info.)</p>
      <p>A view must communicate updates to its window position to the session manager. (The session manager will set metadata accordingly, probably by communicating with the file manager.)</p>
      <p>(Should there be a FILE_MANAGER? Is the session manager enough?)</p>
      <p>If a view contains items which may be opened in other windows, it should act as a folder or workspace. (Which?)</p>
      <p>A view may use alerts, dialogs, palettes, panels, or other transient windows. They should be marked as such for the window manager.</p>
      <p>(Palettes should hide on focus loss, but alerts and dialogs should not. What about other panels?)</p>
      <p>Folder views must provide to . . . </p>
      <p>Is the property panel another process? Maybe. It should be treated like any other view. How do all the views synchronize?</p>
      <p>For moving to Wayland, I'll probably need a trace protocol to make the connections between desktops and views.</p>
      <p>IDK what people are doing for session management these days.</p>
      <p>If a view contains items, it should accept template drops to create new items.</p>
    </section>
    <section><h2>Some Implementation Thoughts</h2>
      <section><h3>Folders</h3>
        <p>I'll probably implement folders in a small app called <code>folder</code>. The app will do a bit of desktop integration and then use a library called <code>libfolder</code> which provides most of the code for the field of icons view. I imagine there will be one <code>folder</code> process for each folder view. Workspaces and desktops will do much the same using <code>libfolder</code>, but they need more code to do session management. The main argument to <code>folder</code> is a URL for something which can be viewed as a folder. If the URL is for anything other than a simple directory, it will probably be handled by another program instead. A program called <code>archive</code>, for example, might handle gzipped directories. This program will also use <code>libfolder</code>, so the archive will act like a folder.</p>
        <p>OS/2 had the System Object Model which allowed for extensibility like with <code>archive</code> and <code>folder</code>. I don't know that anything that complicated is really necessary. There might be a better way now with something like DBus or flatpak portals.</p>
      </section>
      <section><h3>Property Panels</h3>
        <p>The trickiest thing may be the property panels. Every view of an item may need to add or add to a property panel page.</p>
      </section>
      <section><h3>Context menus</h3>
        <p>Closely related to panel extensibility is context menu extensibility. (Do we <code>View as . . .</code> or <code>Open as . . .</code>?) It may be useful to add menu items in addition to those on the <code>View as . . .</code> submenu.</p>
        <p>Does dbusmenu (whatever it's called) actually work for our menu bar?</p>
      </section>
      <section><h3>Positioning Views</h3>
        <p>Positioning views on X is easy, but Wayland doesn't allow client-dictated absolute positioning. There might be a way to have window manager/compositor-dictated positioning that preserves view positions. The views would have to advertise themselves as displaying a URI as a particular type of view. The wm/compositor would use that information to retrieve item metadata from somewhere and store it to somewhere.</p>
        <p>My original thought was that position metadata would be stored either in special files or in extended attributes (EA). Clients would look up their own info and request their positions. It might be possible to have the wm/compositor maintain, or at least use, some database of URI, view type, and view position data. For local views, this can still be done in special files or EAs.</p>
        <p>Not having the position data in EAs seems a good way to lose it, in the event that a file is moved. There would have to be some system level control of files that updates the position database.</p>
        <p>Another problem with the window manager looking up position data is that it will be complicated for remote clients.</p>
      </section>
    </section>
    <section><h2>Special Programs</h2>
      <p>There are a few special programs which break the rules of the shell.</p>
      <section><h3>Terminal</h3>
        <p>The terminal program is a general purpose view of character data. It is available as an execution parameter for shells, scripts, etc. All of the text shell templates produce files which will open in a terminal.</p>
      </section>
      <section><h3>Web Browser</h3>
        <p>What can be said about this? It's essential, but its contents aren't really part of the shell. Bookmarks, on the other hand, can be filed away; they can be items.</p>
      </section>
      <section><h3>Help Browser</h3>
        <p>The help browser is available from the menu bar.</p>
      </section>
      <section><h3>File Browser</h3>
        <p>The file browser is what's usually called the file manager in other shells. It exists for GUI access to parts of the system which are not represented in the shell.</p>
      </section>
      <section><h3>Calculator</h3>
        <p>The calculator is a simple calculator.</p>
      </section>
    </section>
    <section><h2>Items and Containers</h2>
      <dl>
        <dt>Folder</dt>
        <dt>Workspace</dt>
        <dt>Desktop</dt>
        <dt>Archive</dt>
        <dt>Shell - which runs in a terminal</dt>
        <dt>vCard</dt>
        <dt>Address Book - a container for vCards</dt>
        <dt>Event</dt>
        <dt>Calendar - a container for events</dt>
        <dt>Citation</dt>
        <dt>Bibdtography - a container for citations</dt>
        <dt>Feed</dt>
        <dt>Formatted Text</dt>
        <dt>Binder - a container for formatted text</dt>
        <dt>Slide</dt>
        <dt>Presentation - a container for slides</dt>
        <dt>Spreadsheet</dt>
        <dt>Raster Image</dt>
        <dt>Vector Image</dt>
        <dt>Photo</dt>
        <dt>Notebook - in the sense of note-taking software</dt>
        <dt>Computational Notebook</dt>
        <dt>Outline</dt>
        <dt>Bookmark</dt>
        <dt>Help Document</dt>
        <dt>Ledger</dt>
        <dt>Program</dt>
        <dt>Project</dt>
        <dt>Library - in the sense of a group of items particular to a kind of project, like parts for CAD</dt>
      </dl>
      <p>And basically every IANA media type.</p>
    </section>
    <dl>
      <dt>Item</dt>
      <dd>A user interface object. It's part of the user's model of what the computer is doing. The implementation of an item will have multiple parts in the programmer's model. The word "item" is used to be distinct from other kinds of objects that the programmer may use.</dd>
      <dt>View</dt>
      <dd>A visual representation of an item. Every item has at least two views: the icon and the property panel.</dd>
      <dt>Template</dt>
      <dd>An item that produces items. A template has only two views: its icon and its property panel.</dd>
      <dt>Icon</dt>
      <dd>The most basic view of an item. A small graphic providing minimal information about an item.</dd>
      <dt>Property Panel</dt>
      <dd>A view of an item's metadata. An item's metadata can be pulled from multiple sources.</dd>
      <dt>Folder</dt>
      <dd>A container for items. The main view of a folder shows the icons and names of the items it contains.</dd>
      <dt>Workspace</dt>
      <dd>A folder which retains stateful information about its items.</dd>
      <dt>Desktop</dt>
      <dd>A workspace for which the main view is a field of icons that forms the background of the screen.</dd>
    </dl>
    <p>Everything is an item.</p>
    <p>There's a text editor, but you never run the editor.  Instead, you double-click the icon representing a text file. To create a new text file, you drag an icon off the text file template and drop it somewhere. By default, this opens the property panel for the text file. From then on, you just double-click the icon to open the text file. You can shift-double-click to open the property panel again. or you can configure it in the text file's window, using the menu bar.</p></p>
    <p>There's an IDE, but you never run it. Instead, you open a project folder and you see the IDE view of the project contents.</p>
    <p>There's a remote desktop application, but you never run the application. Instead, you double-click the icon representing an RDP connection. To create a new RDP connection, you drag an icon off the RDP connection template and drop it somewhere. By default, this opens the property panel for the connection. From then on, you just double-click the icon to open the connection. You can shift-double-click to open the property panel again. or you can configure it in the connection's window, using the menu bar.</p>
    <p>There's an address book, but . . . I'm not sure here. It can be just a folder with vcards that opens up in a special view, but maybe it should be a special database. In either case, there can be a view that looks like the other one. The tricky part is having the address book as a service and at the same time allowing vcards to be anywhere on the system.</p>
    <p>So, the address book may be a really good example for how there are objects and views, but no applications.</p>
    <p>The web browser is an exception; it's both an application and an object unto itself.</p>
        
    <p>The file manager is a key component. In a sense, it is the whole thing. Once a user has signed in, an object called the desktop is shown. The desktop is a special kind of workspace folder, and a workspace folder is a special kind of folder. A folder is a container for other items which is typically viewed as a field of icons. A workspace folder is a folder with memory; it remembers which items in it are open. A desktop is a workspace folder that is shown underneath everything else, without a frame. A user can have more than one desktop, but one is special as the starting desktop.</p>
    <p>The menu bar, being at the top of the screen, might seem important, but it's not. It's the interface of last resort and a system status bar. Showing a menu bar in each window would suggest that the menu bar is a big part of interacting with any object, but it shouldn't be. The top of the screen is a convenient place to reach when nothing else is going right.</p>
    <p>There are some overlay views. There's one that shows all the open objects. Another shows notifications and system status.</p>
    <p>The desktop is the starting point. It contains a few items. An important one is the Templates folder. It contains templates, and only templates. Anything dropped into the templates folder is received as a template. (The original remains.) What is a template? It's a design for a new object. One of the templates is a folder template. To create a new folder, click and drag from the template as if you were doing a regular drag and drop. Immediately, the dragged icon looks like a regular folder, not like the template icon from which the drag was begun. When the icon is finally dropped somewhere outside the template folder, a new folder will be created in that place. Its name, "Folder", will immediately be selected and receive focus so the new folder can be named. Everything new has at least a default name.</p>
    <p>There's a template for every kind of object you can create. Everything is an object, but every object starts out as a template. Applications developers might better be called template makers. Because anyone can make a template, anyone can be an application developer. While the program that shows a file might be called "LibreOffice Writer", what the user experiences is a template for an ODT file. If the user already has an ODT file and drops it into the templates folder, then a new template will be created. While the basic ODT template is a blank document, the user-created ODT template will have whatever content the user's file had.</p>
    <p>If the user drops a folder into the templates folder, then the new template will be for a folder matching the properties and contents of the folder that was dropped. If the user regular works with a certain kind of project, they might make a template folder filled with the things they need for a new project.</p>
    <p>Templates are not confined to the templates folder. By holding Shift while dragging from a template icon, a copy of the template itself can be made. Frequently used templates can thus be available from wherever they are frequently used. A visual art project folder might have a copy of an image template, so it can be quickly accessed to create a new image.</p>
    <p>Folders and their contents do not exactly match the filesystem contents, and looking at a directory isn't necessarily looking at a folder. A music collection might be an example of the latter. While the collection may exist as a directory of OGG files in the file system, that directory can be opened in at least two ways: as a regular folder, to work with files as files, and as a music player, for listening to music. On the other hand, a folder might not represent a directory at all. It could, for example, be a view of some sort of database (table?). The Templates folder on the desktop is such a folder. It is a combination of system templates, which may come from a database, and user-generated templates, which may be stored as files in a hidden directory.</p>
    <p>The file manager, if that's what you want to call it, is responsible for making all of this work.</p>
    <p>To avoid confusion, maybe it's better to call the things on the system "items" instead of "objects". Everything is an item. A folder is a kind of item that contains other items. A workspace folder is a kind of folder that remembers some of the status of its items. The desktop is a workspace folder that is always open behind all the windows and overlays on the screen. Signing in to the system is the same as opening your main desktop folder.</p>
    <p>A template is a special kind of item. It's an item that represents a type of item. (Is there a template template?)</p>
    <p>What are normally thought of as applications are combinations of templates and views. Views are what put windows on the screen. Every item has at least one view: the property view.</p>
    <p>Every item has some sort of metadata. Metadata is stored in different ways. It may be in a file representing an item, in the filesystem extended attributes for that file, in a hidden file in the directory containing the file. All of this metadata is put together in the property view of the item.</p>
    <p>Part of the metadata is about the views of an item. There's a datum that what the default view for the item is. Another datum is the last view of the item. For every datum about the views of the item, there is a datum about the location on the screen where the view was last seen. When the user opens an item, this position information is passed on the program responsible for the view of the item so that it can tell the compositor or window manager where the view should be shown. Also passed along, for the use of the view and the compositor, is the screen location of the item's icon and the timestamp of the event responsible for opening the view. This allows animation of the opening view to spring from the icon and, if the timestamps are right, the new window will be activated.</p>
    <p>The property view is a window with some pages. The pages may be accessed from fixed tabs when few or from a list when many. Changes made in the view are automatic; there's no OK button.</p>
    <p>Every item created for the system should be a kind of some existing item. A number of primitive items will be provided. Every item has at least a name and an icon, so those properties will appear in every item's General property page. When extending (wc?) an item, a page should be created for new properties. (Changes to system items may change existing pages.) If nothing else, the new page should provide a key-value tree for the new properties. (Maybe there should be a utility for seeing all metadata that way.) Not all properties need to be exposed in the user interface.</p>
    <p>It is likely that many items will extend the Folder item. The OpenDocument format, for example, consists of a zip archive, which can be viewed as a folder.</p>
    <p>Actually, objects may be the wrong idea. Interfaces may be more appropriate.</p>
    <p>The OpenDocument format need not be written as an extension of the Folder item, but the system may nonetheless detect that the file is a zip archive and thus provide the View As Folder option.</p>
    <p><strong>The user interface is pulling together multiple sources of information to provide a simple interface of items.</strong> The basic metadata for a Folder may pull in information from the folder's contents, the parent folder's contents, the user's dot files, system files, and user and system databases. This may be very complicated, but it's all hidden from the casual user.</p>
    <p>Some programs may just be programs. A simple calculator is one example. A terminal is another example, but it has an interesting twist. A terminal window always (?) runs some program, typically a shell. The terminal program file will be accessible through a file browser or command line, but the utility item should be a shell. The item may have a Program property page which identifies both the actual terminal program (e.g. "/usr/bin/xterm -hold -e") and the shell to be run. A calculator may be more than simple. Perhaps there's a calculator that keeps a record. It should provide a template for a record of calculations.</p>
    <p>One thing to move away from is "saving" data. The user's work should always be preserved. In other words, auto-save should be the rule, not the exception. There is, however, still a use for those reflexive Mod-s keystrokes. Stamping. While the item in front of the user will be preserved in the place from whence it came, it may be useful to make copies at different stages of development. In other words, a time-stamped, possibly read-only by default, copy.</p>
    <h2>But I'm a developer!</h2>
    <p>If you use an IDE, not much changes. An IDE is a view of an item called a project. Your project is likely to be a bunch of files in a directory. That's fine. The shell will recognize the directory as a project and, by default, open it in your IDE. If you need to manipulate the contents of the directory outside of the IDE, you can view the project as a folder. Of course, you can always use a text shell in a terminal too.</p>
    <p>If you don't use an IDE, the shell can be like an IDE for you. Again, you are working with a bunch of files in a directory, so you can view that as a folder. More importantly, you can set that folder as a workspace. When you open the workspace, your previously opened views will open again. With not much work, you can make sure that all the tools you use are ready for you.</p>
    <h2>What about git?</h2>
    <p>It should be possible to make a view for a git repository that recognizes its complexity. Since a repository usually contains a project, an IDE may be the view of choice for working with that repository.</p>
    <p>However git is integrated with the shell, it is likely that "git repository" will be a new kind of item. A project is a git repository is a folder is an item.</p>
    <p>The problem with git for the shell is that file metadata may be easily lost, no matter how it's stored. I have no solution for that at this time. It will likely require a special file in the directory containing metadata for a particular version.</p>
    <h2>I need a terminal.</h2>
    <p>There are templates for text shells and they use the terminal program to show the text shells. Once you've created a text shell item, by dragging and dropping from the template, you can configure it to your liking through the property panel. You can change the terminal program used as well as the text shell used in the terminal program. You can set environment variable, initialization files, etc. You can even run non-shell programs in the terminal.</p>
    <h2>But I like applications!</h2>
    <p>In that case, I strongly recommend you use a Mac. It provides the best application-oriented experience by far.</p>
  </body>
</html>
